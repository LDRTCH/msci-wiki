<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Dissipation Learning in Active Matter – week20-22</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      Dissipation Learning in Active Matter
      </li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Dissipation Learning in Active Matter</a> 
        <div class="sidebar-tools-main">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-git"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/ldrtch/msci-wiki">
            GitHub mirror
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true"><i class="bi bi-person-fill" role="img">
</i> 
 <span class="menu-text">Personal</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../activity_log/landing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Activity log</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../motivational-report/motivational-report.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Motivational Report</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../structured_information/landing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Information Glossary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CNN Models</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false"><i class="bi bi-archive" role="img">
</i> 
 <span class="menu-text">Python Notebooks</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/cp_network.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Preliminary CNN Training and Analysis</strong></span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true"><i class="bi bi-diagram-3-fill" role="img">
</i> 
 <span class="menu-text">Shared</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://github.com/LDRTCH/msci-wiki" class="sidebar-item-text sidebar-link"><i class="bi bi-git" role="img">
</i> 
 <span class="menu-text">GitHub Repository (cp fork)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://github.com/dlactivematter" class="sidebar-item-text sidebar-link"><i class="bi bi-git" role="img">
</i> 
 <span class="menu-text">GitHub Shared Organisation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://cryptpad.fr/sheet/#/3/sheet/edit/7200dabe21ea346d966571a07eb6f33a/" class="sidebar-item-text sidebar-link"><i class="bi bi-pc-display" role="img">
</i> 
 <span class="menu-text">CNN Models Parameter Tables</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false"><i class="bi bi-diagram-2-fill" role="img">
</i> 
 <span class="menu-text">FT notes</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../shared/ftnotes/label.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Minimal cluster analysis</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.zotero.org/groups/5210328/dissipation_learning_in_active_matter/library" class="sidebar-item-text sidebar-link"><i class="bi bi-bookmarks-fill" role="img">
</i> 
 <span class="menu-text">Zotero library</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul class="collapse">
  <li><a href="#weeks-20-22" id="toc-weeks-20-22" class="nav-link active" data-scroll-target="#weeks-20-22">Weeks 20-22</a></li>
  <li><a href="#table-of-contents" id="toc-table-of-contents" class="nav-link" data-scroll-target="#table-of-contents">0. Table of Contents</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">1. Introduction</a></li>
  <li><a href="#cluster-periodicity" id="toc-cluster-periodicity" class="nav-link" data-scroll-target="#cluster-periodicity">2. Cluster Periodicity</a></li>
  <li><a href="#cluster-number-and-size-examination" id="toc-cluster-number-and-size-examination" class="nav-link" data-scroll-target="#cluster-number-and-size-examination">3. Cluster Number and Size Examination</a>
  <ul class="collapse">
  <li><a href="#import-libraries-1" id="toc-import-libraries-1" class="nav-link" data-scroll-target="#import-libraries-1">Import Libraries</a></li>
  <li><a href="#get-biggest-cluster-cluster-count-details" id="toc-get-biggest-cluster-cluster-count-details" class="nav-link" data-scroll-target="#get-biggest-cluster-cluster-count-details">Get Biggest Cluster + Cluster Count Details</a></li>
  <li><a href="#create-dataframe-storage" id="toc-create-dataframe-storage" class="nav-link" data-scroll-target="#create-dataframe-storage">Create Dataframe Storage</a></li>
  <li><a href="#plot-results" id="toc-plot-results" class="nav-link" data-scroll-target="#plot-results">Plot Results</a></li>
  </ul></li>
  <li><a href="#percolation-analysis" id="toc-percolation-analysis" class="nav-link" data-scroll-target="#percolation-analysis">4. Percolation Analysis</a></li>
  <li><a href="#cluster-orientation-analysis" id="toc-cluster-orientation-analysis" class="nav-link" data-scroll-target="#cluster-orientation-analysis">5. Cluster Orientation Analysis</a>
  <ul class="collapse">
  <li><a href="#import-data" id="toc-import-data" class="nav-link" data-scroll-target="#import-data">Import Data</a></li>
  <li><a href="#define-functions" id="toc-define-functions" class="nav-link" data-scroll-target="#define-functions">Define Functions</a></li>
  <li><a href="#plot-cluster-map" id="toc-plot-cluster-map" class="nav-link" data-scroll-target="#plot-cluster-map">Plot Cluster Map</a></li>
  <li><a href="#get-frequency-of-up-down-edge-orientations" id="toc-get-frequency-of-up-down-edge-orientations" class="nav-link" data-scroll-target="#get-frequency-of-up-down-edge-orientations">Get Frequency of Up-Down Edge Orientations</a></li>
  <li><a href="#get-frequency-of-left-right-edge-orientations" id="toc-get-frequency-of-left-right-edge-orientations" class="nav-link" data-scroll-target="#get-frequency-of-left-right-edge-orientations">Get Frequency of Left-Right Edge Orientations</a></li>
  <li><a href="#get-frequency-of-up-down-scrambled-edge-orientations" id="toc-get-frequency-of-up-down-scrambled-edge-orientations" class="nav-link" data-scroll-target="#get-frequency-of-up-down-scrambled-edge-orientations">Get Frequency of Up-Down Scrambled Edge Orientations</a></li>
  <li><a href="#get-frequency-of-left-right-scrambled-edge-orientations" id="toc-get-frequency-of-left-right-scrambled-edge-orientations" class="nav-link" data-scroll-target="#get-frequency-of-left-right-scrambled-edge-orientations">Get Frequency of Left-Right Scrambled Edge Orientations</a></li>
  <li><a href="#plot-cluster-edge-orientations" id="toc-plot-cluster-edge-orientations" class="nav-link" data-scroll-target="#plot-cluster-edge-orientations">Plot Cluster Edge Orientations</a></li>
  <li><a href="#plot-waffle-plot-distribution-for-horizontal-filter" id="toc-plot-waffle-plot-distribution-for-horizontal-filter" class="nav-link" data-scroll-target="#plot-waffle-plot-distribution-for-horizontal-filter">Plot Waffle Plot Distribution For Horizontal Filter</a></li>
  <li><a href="#frequency-comparison" id="toc-frequency-comparison" class="nav-link" data-scroll-target="#frequency-comparison">Frequency Comparison</a></li>
  </ul></li>
  <li><a href="#feature-map-analysis-orientation-data-type" id="toc-feature-map-analysis-orientation-data-type" class="nav-link" data-scroll-target="#feature-map-analysis-orientation-data-type">6. Feature Map Analysis (Orientation Data Type)</a>
  <ul class="collapse">
  <li><a href="#import-libraries-3" id="toc-import-libraries-3" class="nav-link" data-scroll-target="#import-libraries-3">Import Libraries</a></li>
  <li><a href="#load-datasets" id="toc-load-datasets" class="nav-link" data-scroll-target="#load-datasets">Load Datasets</a></li>
  <li><a href="#example-datamaps-p_t-in-0.0500.157-rho-0.25" id="toc-example-datamaps-p_t-in-0.0500.157-rho-0.25" class="nav-link" data-scroll-target="#example-datamaps-p_t-in-0.0500.157-rho-0.25">Example Datamaps (<span class="math inline">\(P_t \in \{ 0.050,0.157\}\)</span>, <span class="math inline">\(\rho = 0.25\)</span>)</a></li>
  <li><a href="#set-up-gpu-and-load-model" id="toc-set-up-gpu-and-load-model" class="nav-link" data-scroll-target="#set-up-gpu-and-load-model">Set Up GPU and Load Model</a></li>
  <li><a href="#plot-feature-maps" id="toc-plot-feature-maps" class="nav-link" data-scroll-target="#plot-feature-maps">Plot Feature Maps</a></li>
  <li><a href="#some-notes" id="toc-some-notes" class="nav-link" data-scroll-target="#some-notes">Some notes</a></li>
  </ul></li>
  <li><a href="#feature-map-analysis-monochrome-data-type" id="toc-feature-map-analysis-monochrome-data-type" class="nav-link" data-scroll-target="#feature-map-analysis-monochrome-data-type">7. Feature Map Analysis (Monochrome Data Type)</a>
  <ul class="collapse">
  <li><a href="#import-libraries-4" id="toc-import-libraries-4" class="nav-link" data-scroll-target="#import-libraries-4">Import Libraries</a></li>
  <li><a href="#load-datasets-1" id="toc-load-datasets-1" class="nav-link" data-scroll-target="#load-datasets-1">Load Datasets</a></li>
  <li><a href="#example-datamaps-p_t-in-0.0500.157-rho-0.25-1" id="toc-example-datamaps-p_t-in-0.0500.157-rho-0.25-1" class="nav-link" data-scroll-target="#example-datamaps-p_t-in-0.0500.157-rho-0.25-1">Example Datamaps (<span class="math inline">\(P_t \in \{ 0.050,0.157\}\)</span>, <span class="math inline">\(\rho = 0.25\)</span>)</a></li>
  <li><a href="#set-up-gpu-and-load-model-1" id="toc-set-up-gpu-and-load-model-1" class="nav-link" data-scroll-target="#set-up-gpu-and-load-model-1">Set Up GPU and Load Model</a></li>
  <li><a href="#plot-feature-maps-1" id="toc-plot-feature-maps-1" class="nav-link" data-scroll-target="#plot-feature-maps-1">Plot Feature Maps</a></li>
  <li><a href="#some-notes-1" id="toc-some-notes-1" class="nav-link" data-scroll-target="#some-notes-1">Some notes</a></li>
  </ul></li>
  <li><a href="#final-averaged-predictions" id="toc-final-averaged-predictions" class="nav-link" data-scroll-target="#final-averaged-predictions">8. Final Averaged Predictions</a>
  <ul class="collapse">
  <li><a href="#import-packages" id="toc-import-packages" class="nav-link" data-scroll-target="#import-packages">Import packages</a></li>
  <li><a href="#set-seed-optional" id="toc-set-seed-optional" class="nav-link" data-scroll-target="#set-seed-optional">Set seed (optional)</a></li>
  <li><a href="#setup-gpu" id="toc-setup-gpu" class="nav-link" data-scroll-target="#setup-gpu">Setup GPU</a></li>
  <li><a href="#define-functions-1" id="toc-define-functions-1" class="nav-link" data-scroll-target="#define-functions-1">Define Functions</a></li>
  <li><a href="#import-and-prepare-data" id="toc-import-and-prepare-data" class="nav-link" data-scroll-target="#import-and-prepare-data">Import and prepare data</a></li>
  <li><a href="#predict-multiple-models" id="toc-predict-multiple-models" class="nav-link" data-scroll-target="#predict-multiple-models">Predict multiple models</a></li>
  <li><a href="#combined-plots" id="toc-combined-plots" class="nav-link" data-scroll-target="#combined-plots">Combined plots</a></li>
  </ul></li>
  <li><a href="#interpolation" id="toc-interpolation" class="nav-link" data-scroll-target="#interpolation">9. Interpolation</a>
  <ul class="collapse">
  <li><a href="#interpolation-predictions-on-same-data-types" id="toc-interpolation-predictions-on-same-data-types" class="nav-link" data-scroll-target="#interpolation-predictions-on-same-data-types">Interpolation Predictions on Same Data Types</a></li>
  <li><a href="#interpolation-predictions-on-other-data-types" id="toc-interpolation-predictions-on-other-data-types" class="nav-link" data-scroll-target="#interpolation-predictions-on-other-data-types">Interpolation Predictions on Other Data Types</a></li>
  </ul></li>
  <li><a href="#extrapolation" id="toc-extrapolation" class="nav-link" data-scroll-target="#extrapolation">10. Extrapolation</a>
  <ul class="collapse">
  <li><a href="#low-bound-extrapolation" id="toc-low-bound-extrapolation" class="nav-link" data-scroll-target="#low-bound-extrapolation">Low-bound Extrapolation</a></li>
  <li><a href="#high-bound-extrapolation" id="toc-high-bound-extrapolation" class="nav-link" data-scroll-target="#high-bound-extrapolation">High-bound Extrapolation</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML">
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true},
      jax: ["input/TeX","input/MathML","input/AsciiMath","output/CommonHTML"],
      extensions: ["tex2jax.js","mml2jax.js","asciimath2jax.js","MathMenu.js","MathZoom.js","AssistiveMML.js", "[Contrib]/a11y/accessibility-menu.js"],
      TeX: {
      extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"],
      equationNumbers: {
      autoNumber: "AMS"
      }
    }
  });
</script>
<section id="weeks-20-22" class="level1">
<h1>Weeks 20-22</h1>
</section>
<section id="table-of-contents" class="level1">
<h1>0. Table of Contents</h1>
<ol type="1">
<li>Introduction</li>
<li>Cluster Periodicity and Revised Cluster Histograms</li>
<li>Cluster Number and Size Examination</li>
<li>Percolation Analysis</li>
<li>Cluster Edge Orientation</li>
<li>Feature Map Visualisation (Orientation)</li>
<li>Feature Map Visualisation (Monochrome)</li>
<li>Final Averaged Predictions</li>
<li>Interpolation</li>
<li>Extrapolation</li>
</ol>
</section>
<section id="introduction" class="level1">
<h1>1. Introduction</h1>
<p>The aims of these last few weeks is to finish up experimental analysis, revise some mistakes in previous weeks, as well as prepare figures for the final report. These Weeks will also contain all the final results of analysis that were previously not fully included in the activity log (due to preliminary individual work which was shared at the end between lab partners).</p>
</section>
<section id="cluster-periodicity" class="level1">
<h1>2. Cluster Periodicity</h1>
<p>This is an improved version of <code>cluster-analysis.py</code>, which can be found in the <code>src</code> folder. It uses a newer function which separates clusters while keeping boundary periodicity. The jupyter notebook can be found in <code>notebooks/cp_cluster_analysis.ipynb</code>.</p>
<section id="import-libraries" class="level3">
<h3 class="anchored" data-anchor-id="import-libraries">Import Libraries</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> ndimage</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cmcrameri <span class="co">#for different cmaps</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.axes_grid1.inset_locator <span class="im">import</span> inset_axes</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">'./..'</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.utils <span class="im">import</span> get_cluster_labels,get_ds_iters</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#from src.plot_utils import get_plot_configs</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.training_utils <span class="im">import</span> extract_floats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>2024-04-11 12:40:58.351512: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2024-04-11 12:40:59.880218: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2024-04-11 12:41:01.535476: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT</code></pre>
</section>
<section id="set-analysis-conditions" class="level3">
<h3 class="anchored" data-anchor-id="set-analysis-conditions">Set Analysis Conditions</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Pt<span class="op">=</span><span class="fl">0.034</span> <span class="co">#tumble probability</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>rho<span class="op">=</span><span class="fl">0.3</span> <span class="co">#particle density</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="bu">file</span> <span class="op">=</span> (<span class="st">"../data/no-rolling/dataset_tumble_</span><span class="sc">{}</span><span class="st">_density_</span><span class="sc">{}</span><span class="st">.h5"</span>.<span class="bu">format</span>(Pt,rho)) <span class="co">#change this to analyse different file</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>cmap1 <span class="op">=</span> plt.get_cmap(name<span class="op">=</span><span class="st">"cmc.lajolla"</span>) <span class="co">#cmap for first picture</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>cmap2 <span class="op">=</span> plt.get_cmap(name<span class="op">=</span><span class="st">"cmc.tokyoS"</span>) <span class="co">#cmap for second picture</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="run-analysis-and-plot" class="level3">
<h3 class="anchored" data-anchor-id="run-analysis-and-plot">Run Analysis and Plot</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>hfile <span class="op">=</span> h5py.File(<span class="bu">file</span>,<span class="st">"r"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>fig, (regplot, clusterplot, clusterhistogram) <span class="op">=</span> plt.subplots (<span class="dv">1</span>,<span class="dv">3</span>,figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">3</span>),width_ratios<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">1.3</span>),constrained_layout<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>iters <span class="op">=</span> get_ds_iters(hfile.keys())</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="vs">r"Cluster Analysis ($P_</span><span class="sc">{tumble}</span><span class="vs">=</span><span class="sc">%.3f</span><span class="vs">$; $\rho=</span><span class="sc">%.3f</span><span class="vs">$)"</span> <span class="op">%</span> (Pt,rho))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#plot regular graph</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>image <span class="op">=</span> hfile[<span class="ss">f"conf_</span><span class="sc">{</span>iters[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>regplot.matshow(image,cmap<span class="op">=</span>cmap1)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#plot cluster separation graph</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>kernel <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>],</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>          [<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>],</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>          [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>]]</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>labelled, _ <span class="op">=</span> ndimage.label(image,structure<span class="op">=</span>kernel)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># periodicity establishment</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(labelled.shape[<span class="dv">0</span>]):</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> labelled[y, <span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> labelled[y, <span class="op">-</span><span class="dv">1</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        labelled[labelled <span class="op">==</span> labelled[y, <span class="op">-</span><span class="dv">1</span>]] <span class="op">=</span> labelled[y, <span class="dv">0</span>]</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(labelled.shape[<span class="dv">1</span>]):</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> labelled[y, <span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> labelled[y, <span class="op">-</span><span class="dv">1</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        labelled[labelled <span class="op">==</span> labelled[y, <span class="op">-</span><span class="dv">1</span>]] <span class="op">=</span> labelled[y, <span class="dv">0</span>]</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>clusterplot.matshow(labelled,cmap<span class="op">=</span>cmap2)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co">#plot histogram of obtained clusters</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>cluster_sizes <span class="op">=</span> np.bincount(labelled.flatten())[<span class="dv">1</span>:]</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>cluster_sizes <span class="op">=</span> np.delete(cluster_sizes,np.where(cluster_sizes<span class="op">==</span><span class="dv">0</span>))</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cluster_sizes.<span class="bu">min</span>(),cluster_sizes.<span class="bu">max</span>())</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>bin_edges <span class="op">=</span> np.logspace(np.log2(cluster_sizes.<span class="bu">min</span>()), np.log2(cluster_sizes.<span class="bu">max</span>()), <span class="dv">30</span>, base<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co">#bin_edges = np.linspace(cluster_sizes.min(),cluster_sizes.max(),100)</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>counts, _ <span class="op">=</span> np.histogram(cluster_sizes,bins<span class="op">=</span>bin_edges,density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>clusterhistogram.grid(alpha<span class="op">=</span><span class="fl">.4</span>)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>clusterhistogram.set_axisbelow(<span class="va">True</span>)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>clusterhistogram.scatter(bin_edges[:<span class="op">-</span><span class="dv">1</span>],counts,edgecolor<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>),facecolor<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">.5</span>))</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>clusterhistogram.set_yscale(<span class="st">"log"</span>), clusterhistogram.set_xscale(<span class="st">"log"</span>)</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>clusterhistogram.set_xlabel(<span class="st">"Cluster Size"</span>)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>fig.colorbar(plt.cm.ScalarMappable(cmap<span class="op">=</span>cmap1),ax<span class="op">=</span>regplot)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>fig.colorbar(plt.cm.ScalarMappable(cmap<span class="op">=</span>cmap2),ax<span class="op">=</span>clusterplot)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>1 414</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_cluster_analysis_files/cp_cluster_analysis_6_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="array-of-cluster-analysis" class="level3">
<h3 class="anchored" data-anchor-id="array-of-cluster-analysis">Array of Cluster Analysis</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_configs = get_plot_configs()</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_configs["xtick.labelsize"] = 8</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_configs["ytick.labelsize"] = 8</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.rcParams.update(plot_configs)</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">9</span> <span class="op">*</span> <span class="dv">3</span> <span class="op">/</span> <span class="dv">5</span>, <span class="dv">9</span>), constrained_layout<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>gspec <span class="op">=</span> fig.add_gridspec(<span class="dv">5</span>, <span class="dv">3</span>, wspace<span class="op">=</span><span class="fl">0.15</span>, hspace<span class="op">=</span><span class="fl">0.15</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> <span class="st">"cmc.lajolla"</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>tumbles <span class="op">=</span> [<span class="fl">0.016</span>,<span class="fl">0.034</span>,<span class="fl">0.073</span>,<span class="fl">0.157</span>,<span class="fl">0.340</span>]</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>densities <span class="op">=</span> [<span class="fl">0.15</span>,<span class="fl">0.25</span>,<span class="fl">0.35</span>]</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> []</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tumble <span class="kw">in</span> tumbles:</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> density <span class="kw">in</span> densities:</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        files.append(<span class="ss">f"../data/no-rolling/dataset_tumble_</span><span class="sc">{</span>tumble<span class="sc">:.3f}</span><span class="ss">_density_</span><span class="sc">{</span>density<span class="sc">}</span><span class="ss">.h5"</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>ctr <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> jdx <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        axis <span class="op">=</span> fig.add_subplot(gspec[idx, jdx], autoscale_on<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        inaxis <span class="op">=</span> inset_axes(axis,width<span class="op">=</span><span class="st">"100%"</span>,height<span class="op">=</span><span class="st">"100%"</span>,loc<span class="op">=</span><span class="st">"upper right"</span>,bbox_to_anchor<span class="op">=</span>(<span class="fl">0.56</span>,<span class="fl">0.53</span>,<span class="fl">.55</span>,<span class="fl">.55</span>),bbox_transform<span class="op">=</span>axis.transAxes)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> h5py.File(files[ctr], <span class="st">"r"</span>) <span class="im">as</span> fin:</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>            key_list <span class="op">=</span> <span class="bu">list</span>(fin.keys())</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>            iter_n <span class="op">=</span> get_ds_iters(key_list)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>            img <span class="op">=</span> fin[<span class="ss">f"conf_</span><span class="sc">{</span>iter_n[<span class="op">-</span><span class="dv">2</span>]<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>            kernel <span class="op">=</span> [[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>],</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>                      [<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>],</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>                      [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>]]</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>            labelled, _ <span class="op">=</span> ndimage.label(img,structure<span class="op">=</span>kernel)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(labelled.shape[<span class="dv">0</span>]):</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> labelled[y, <span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> labelled[y, <span class="op">-</span><span class="dv">1</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>                    labelled[labelled <span class="op">==</span> labelled[y, <span class="op">-</span><span class="dv">1</span>]] <span class="op">=</span> labelled[y, <span class="dv">0</span>]</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(labelled.shape[<span class="dv">1</span>]):</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> labelled[y, <span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> labelled[y, <span class="op">-</span><span class="dv">1</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>                    labelled[labelled <span class="op">==</span> labelled[y, <span class="op">-</span><span class="dv">1</span>]] <span class="op">=</span> labelled[y, <span class="dv">0</span>]</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>            cluster_sizes <span class="op">=</span> np.bincount(labelled.flatten())[<span class="dv">1</span>:]</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>            cluster_sizes <span class="op">=</span> np.delete(cluster_sizes,np.where(cluster_sizes<span class="op">==</span><span class="dv">0</span>))</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(cluster_sizes.<span class="bu">min</span>(),cluster_sizes.<span class="bu">max</span>())</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>            bin_edges <span class="op">=</span> np.logspace(np.log2(cluster_sizes.<span class="bu">min</span>()), np.log2(cluster_sizes.<span class="bu">max</span>()), <span class="dv">30</span>, base<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>            <span class="co">#bin_edges = np.linspace(cluster_sizes.min(),cluster_sizes.max(),100)</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>            counts, _ <span class="op">=</span> np.histogram(cluster_sizes,bins<span class="op">=</span>bin_edges,density<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>            axis.grid(alpha<span class="op">=</span><span class="fl">.4</span>)</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>            axis.set_axisbelow(<span class="va">True</span>)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>            axis.scatter(bin_edges[:<span class="op">-</span><span class="dv">1</span>],counts,edgecolor<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>),facecolor<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">.5</span>))</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>            axis.set_yscale(<span class="st">"log"</span>), axis.set_xscale(<span class="st">"log"</span>)</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>            axis.set_xlabel(<span class="st">"Cluster Size"</span>)</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>            inaxis.matshow(img, cmap<span class="op">=</span>cmap)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>            inaxis.set_xticks([])</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>            inaxis.set_yticks([])</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>            axis.set_xlim((cluster_sizes.<span class="bu">min</span>()<span class="op">-</span><span class="dv">20</span>, cluster_sizes.<span class="bu">max</span>()<span class="op">+</span><span class="dv">5</span>))</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>            axis.set_ylim((<span class="op">-</span><span class="dv">20</span>, <span class="dv">200</span>))</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>        axis.set_title(<span class="vs">r"$P_</span><span class="sc">{t}</span><span class="vs">=</span><span class="sc">%s</span><span class="vs">$, $ \rho = </span><span class="sc">%s</span><span class="vs"> $ "</span> <span class="op">%</span> (tumbles[idx],densities[jdx]))</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>        ctr <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>fig.supylabel(<span class="vs">r"Inverse Tumbling Probability, $P_</span><span class="sc">{tumble}</span><span class="vs">^{-1}$"</span>)</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>fig.supxlabel(<span class="vs">r"Density, $\rho$"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>1 132
1 224
1 593
1 70
1 165
1 434
1 42
1 104
1 254
1 20
1 51
1 115
1 9
1 37
1 82


/tmp/ipykernel_7618/475512023.py:56: UserWarning: Attempt to set non-positive xlim on a log-scaled axis will be ignored.
  axis.set_xlim((cluster_sizes.min()-20, cluster_sizes.max()+5))
/tmp/ipykernel_7618/475512023.py:57: UserWarning: Attempt to set non-positive ylim on a log-scaled axis will be ignored.
  axis.set_ylim((-20, 200))





Text(0.5, 0.01, 'Density, $\\rho$')</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_cluster_analysis_files/cp_cluster_analysis_8_3.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
</section>
<section id="cluster-number-and-size-examination" class="level1">
<h1>3. Cluster Number and Size Examination</h1>
<section id="import-libraries-1" class="level2">
<h2 class="anchored" data-anchor-id="import-libraries-1">Import Libraries</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">'./..'</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> ndimage</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> ticker</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cmcrameri <span class="im">import</span> cm</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.utils <span class="im">import</span> get_ds_iters, get_cluster_labels</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.plot_utils <span class="im">import</span> get_plot_configs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="get-biggest-cluster-cluster-count-details" class="level2">
<h2 class="anchored" data-anchor-id="get-biggest-cluster-cluster-count-details">Get Biggest Cluster + Cluster Count Details</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>densities <span class="op">=</span> [<span class="fl">0.1</span>,<span class="fl">0.15</span>,<span class="fl">0.2</span>,<span class="fl">0.25</span>,<span class="fl">0.3</span>,<span class="fl">0.35</span>,<span class="fl">0.4</span>,<span class="fl">0.45</span>,<span class="fl">0.5</span>]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>tumbles <span class="op">=</span> np.logspace(<span class="op">-</span><span class="dv">6</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">10</span>, base<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>num <span class="op">=</span> []</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>big <span class="op">=</span> []</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> []</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> []</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, d <span class="kw">in</span> <span class="bu">enumerate</span>(densities):</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> jdx, t <span class="kw">in</span> <span class="bu">enumerate</span>(tumbles):</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">file</span> <span class="op">=</span> <span class="ss">f"../data/no-rolling/dataset_tumble_</span><span class="sc">{</span>t<span class="sc">:.3f}</span><span class="ss">_density_</span><span class="sc">{</span>d<span class="sc">}</span><span class="ss">.h5"</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx2 <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">500</span>,<span class="dv">1000</span>,<span class="dv">1</span>):</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>            ds.append(d)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>            ts.append(t)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            labelled, nlabels <span class="op">=</span> get_cluster_labels(<span class="bu">file</span>, idx2)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>            lb <span class="op">=</span> labelled.flatten()</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            big.append(np.<span class="bu">max</span>(np.bincount(lb)[<span class="dv">1</span>:]))</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>            num.append(nlabels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="create-dataframe-storage" class="level2">
<h2 class="anchored" data-anchor-id="create-dataframe-storage">Create Dataframe Storage</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df.insert(<span class="dv">0</span>, <span class="st">"alpha"</span>, ts,<span class="dv">300</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>df.insert(<span class="dv">1</span>, <span class="st">"numclus"</span>, num)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>df.insert(<span class="dv">2</span>, <span class="st">"bigsize"</span>, big)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>df.insert(<span class="dv">0</span>, <span class="st">"density"</span>, ds,<span class="dv">300</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">"cache/cluster_count_size.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="plot-results" class="level2">
<h2 class="anchored" data-anchor-id="plot-results">Plot Results</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>tumbles <span class="op">=</span> np.logspace(<span class="op">-</span><span class="dv">6</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">10</span>, base<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"cache/cluster_count_size.csv"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"density"</span>] <span class="op">=</span> [<span class="st">"$</span><span class="sc">%s</span><span class="st">$"</span> <span class="op">%</span> x <span class="cf">for</span> x <span class="kw">in</span> df[<span class="st">"density"</span>]] <span class="co">#this is a rough fix for the sns hue not working properly when fed floats (we fix it by forcing the floats into a latex string; a regular string would yield the same problem!)</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"ticks"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>sns.set_style({<span class="st">"xtick.direction"</span>: <span class="st">"in"</span>,<span class="st">"ytick.direction"</span>: <span class="st">"in"</span>})</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    constrained_layout<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    dpi<span class="op">=</span><span class="dv">600</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> sns.lineplot(ax<span class="op">=</span>axes[<span class="dv">0</span>], data<span class="op">=</span>df, x<span class="op">=</span><span class="st">"alpha"</span>, y<span class="op">=</span><span class="st">"numclus"</span>, errorbar<span class="op">=</span><span class="st">'sd'</span>, marker<span class="op">=</span><span class="st">'o'</span>, hue<span class="op">=</span><span class="st">"density"</span>, palette<span class="op">=</span><span class="st">"cmc.acton"</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> sns.lineplot(ax<span class="op">=</span>axes[<span class="dv">1</span>], data<span class="op">=</span>df, x<span class="op">=</span><span class="st">"alpha"</span>, y<span class="op">=</span><span class="st">"bigsize"</span>, errorbar<span class="op">=</span><span class="st">'sd'</span>, marker<span class="op">=</span><span class="st">'o'</span>, hue<span class="op">=</span><span class="st">"density"</span>, palette<span class="op">=</span><span class="st">"cmc.acton"</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">"Cluster count"</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="vs">r"Biggest cluster volume ($a^2$)"</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax <span class="kw">in</span> axes:</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    ax.set_xscale(<span class="st">'log'</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="vs">r"Tumbling rate ($P_t$)"</span>)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    ax.get_xaxis().set_major_formatter(ticker.ScalarFormatter())</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(np.<span class="bu">round</span>(tumbles,<span class="dv">3</span>)[::<span class="dv">2</span>])</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>ax2.set_yscale(<span class="st">'log'</span>)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>sns.move_legend(ax1, <span class="st">"upper left"</span>, title<span class="op">=</span><span class="vs">r"Density ($\rho$)"</span>,ncols<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>sns.move_legend(ax2, <span class="st">"upper right"</span>, title<span class="op">=</span><span class="vs">r"Density ($\rho$)"</span>,ncols<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>fig.savefig(<span class="st">"../plots/cluster_count_size.pdf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_cluster_number_size_analysis_files/cp_cluster_number_size_analysis_8_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
</section>
<section id="percolation-analysis" class="level1">
<h1>4. Percolation Analysis</h1>
<section id="import-libraries-2" class="level3">
<h3 class="anchored" data-anchor-id="import-libraries-2">Import Libraries</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cmcrameri</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> ndimage</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cmcrameri <span class="im">import</span> cm</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> natsort</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">'./..'</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.utils <span class="im">import</span> get_cluster_labels, get_ds_iters</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.training_utils <span class="im">import</span> extract_floats</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>np.set_printoptions(precision<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>2024-04-11 13:23:37.221633: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2024-04-11 13:23:37.255613: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2024-04-11 13:23:37.701060: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT</code></pre>
</section>
<section id="define-auxiliary-functions" class="level3">
<h3 class="anchored" data-anchor-id="define-auxiliary-functions">Define Auxiliary Functions</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_biggest_cluster_loc(<span class="bu">file</span>, idx):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    kernel <span class="op">=</span> [[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>]]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    labelled, _ <span class="op">=</span> get_cluster_labels(<span class="bu">file</span>, idx)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    lb <span class="op">=</span> labelled.flatten()</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    cluster_sizes <span class="op">=</span> np.bincount(lb)[<span class="dv">1</span>:]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    biggest_cluster_id <span class="op">=</span> np.argmax(cluster_sizes) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.where(labelled <span class="op">==</span> biggest_cluster_id)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_threshold(locs, threshold<span class="op">=</span><span class="dv">20</span>, dim<span class="op">=</span><span class="dv">128</span>):</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(np.ptp(locs[0]), np.ptp(locs[1]))</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.ptp(locs[<span class="dv">0</span>]) <span class="op">&gt;=</span> <span class="dv">128</span><span class="op">-</span>threshold:</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.ptp(locs[<span class="dv">1</span>]) <span class="op">&gt;=</span> <span class="dv">128</span><span class="op">-</span>threshold:</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="establish-percolation-values" class="level3">
<h3 class="anchored" data-anchor-id="establish-percolation-values">Establish Percolation Values</h3>
<p>NOTE: this program is set to append, so it will pile on the same data if this notebook is reran.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>tumbles <span class="op">=</span> np.logspace(<span class="op">-</span><span class="dv">6</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">10</span>,base<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>densities <span class="op">=</span> [<span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.15</span>,<span class="fl">0.2</span>,<span class="fl">0.25</span>,<span class="fl">0.3</span>,<span class="fl">0.35</span>,<span class="fl">0.4</span>,<span class="fl">0.45</span>,<span class="fl">0.5</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> []</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tumble <span class="kw">in</span> tumbles:</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> density <span class="kw">in</span> densities:</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        files.append(<span class="ss">f"../data/no-rolling/dataset_tumble_</span><span class="sc">{</span>tumble<span class="sc">:.3f}</span><span class="ss">_density_</span><span class="sc">{</span>density<span class="sc">}</span><span class="ss">.h5"</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ctr,<span class="bu">file</span> <span class="kw">in</span> <span class="bu">enumerate</span>(files):</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> h5py.File(<span class="bu">file</span>, <span class="st">"r"</span>) <span class="im">as</span> fin:</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        key_list <span class="op">=</span> <span class="bu">list</span>(fin.keys())</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        iter_n <span class="op">=</span> get_ds_iters(key_list)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        percolating <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">50</span>,<span class="dv">1000</span>): <span class="co">#amount of snapshots we have in the data sets</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>            locs <span class="op">=</span> get_biggest_cluster_loc(<span class="bu">file</span>,idx)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>            percolating <span class="op">+=</span> check_threshold(locs)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>            total<span class="op">+=</span><span class="dv">1</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    ratio <span class="op">=</span> <span class="bu">float</span>(percolating) <span class="op">/</span> <span class="bu">float</span>(total)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> extract_floats(<span class="bu">file</span>)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    output_line <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>values[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>values[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>ratio<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">"cache/percolation.txt"</span>, <span class="st">"a"</span>) <span class="im">as</span> cache:</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>        cache.write(output_line)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(output_line,end<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>0.016 0.45 0.8463157894736842
0.023 0.45 0.8010526315789473
0.034 0.45 0.651578947368421
0.050 0.45 0.5063157894736842
0.073 0.45 0.4231578947368421
0.107 0.45 0.4189473684210526
0.157 0.45 0.32105263157894737
0.231 0.45 0.3105263157894737
0.340 0.45 0.24210526315789474
0.500 0.45 0.16631578947368422</code></pre>
</section>
<section id="read-percolations" class="level3">
<h3 class="anchored" data-anchor-id="read-percolations">Read Percolations</h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"cache/percolation.txt"</span>, <span class="st">'r'</span>) <span class="im">as</span> cache:</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> cache.readlines()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    perc <span class="op">=</span> []</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> val <span class="kw">in</span> res:</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        line_list <span class="op">=</span> [<span class="bu">float</span>(i) <span class="cf">for</span> i <span class="kw">in</span> val.split(<span class="st">" "</span>)]</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        perc.append(line_list[<span class="dv">2</span>])</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> line_list[<span class="dv">2</span>] <span class="op">&gt;</span> <span class="fl">0.75</span>: <span class="co">#frequency threshold for percolating condition is 75%</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"tumble </span><span class="sc">{</span>line_list[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, dens </span><span class="sc">{</span>line_list[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> undergoes percolation"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#perc = [float(val.strip('\n')) for val in res[2]]</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    perc <span class="op">=</span> np.reshape(perc, (<span class="dv">10</span>,<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>tumble 0.016, dens 0.45 undergoes percolation
tumble 0.016, dens 0.5 undergoes percolation
tumble 0.023, dens 0.45 undergoes percolation
tumble 0.023, dens 0.5 undergoes percolation
tumble 0.034, dens 0.5 undergoes percolation
tumble 0.05, dens 0.5 undergoes percolation
tumble 0.073, dens 0.5 undergoes percolation</code></pre>
</section>
<section id="plot-results-1" class="level3">
<h3 class="anchored" data-anchor-id="plot-results-1">Plot Results</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>tumbles <span class="op">=</span> np.logspace(<span class="op">-</span><span class="dv">6</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">10</span>, base<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>density <span class="op">=</span> [<span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.15</span>,<span class="fl">0.2</span>,<span class="fl">0.25</span>,<span class="fl">0.3</span>,<span class="fl">0.35</span>,<span class="fl">0.4</span>,<span class="fl">0.45</span>,<span class="fl">0.5</span>]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> plt.get_cmap(<span class="st">'cmc.acton'</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>xlabels <span class="op">=</span> np.concatenate(([<span class="dv">0</span>,<span class="dv">0</span>],tumbles))</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>ylabels <span class="op">=</span> np.concatenate(([<span class="dv">0</span>,<span class="dv">0</span>],density))</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">5</span>), constrained_layout<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> ax.imshow(perc, cmap<span class="op">=</span>cmap.<span class="bu">reversed</span>())</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(ax<span class="op">=</span>ax, mappable<span class="op">=</span>m, location<span class="op">=</span><span class="st">'top'</span>, aspect<span class="op">=</span><span class="dv">20</span>, fraction<span class="op">=</span><span class="fl">0.046</span>, pad<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels(np.<span class="bu">round</span>(xlabels,<span class="dv">3</span>)[::<span class="dv">2</span>])</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(np.<span class="bu">round</span>(ylabels,<span class="dv">3</span>)[::<span class="dv">2</span>])</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>ax.plot([<span class="fl">7.5</span>,<span class="fl">7.5</span>,<span class="fl">8.5</span>,<span class="fl">8.5</span>,<span class="fl">9.5</span>],[<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">1.5</span>,<span class="fl">1.5</span>,<span class="fl">4.5</span>,<span class="fl">4.5</span>], c<span class="op">=</span><span class="st">'white'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>cbar.ax.set_xlabel(<span class="st">'Percolation Frequency'</span>)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="vs">r"Tumbling rate ($P_t$)"</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="vs">r"Density ($\rho$)"</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>ax.text(s<span class="op">=</span><span class="st">"Percolating"</span>, x<span class="op">=</span><span class="fl">8.75</span>, y<span class="op">=</span><span class="dv">3</span>, c<span class="op">=</span><span class="st">'w'</span>, rotation<span class="op">=</span><span class="dv">90</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>/tmp/ipykernel_9498/2130497943.py:12: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
  ax.set_yticklabels(np.round(xlabels,3)[::2])
/tmp/ipykernel_9498/2130497943.py:13: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
  ax.set_xticklabels(np.round(ylabels,3)[::2])





Text(8.75, 3, 'Percolating')</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_percolation_analysis_files/cp_percolation_analysis_10_2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
</section>
<section id="cluster-orientation-analysis" class="level1">
<h1>5. Cluster Orientation Analysis</h1>
<section id="import-data" class="level2">
<h2 class="anchored" data-anchor-id="import-data">Import Data</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cmcrameri</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.axes_grid1.inset_locator <span class="im">import</span> inset_axes</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> ndimage</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cmcrameri <span class="im">import</span> cm</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">'./..'</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.utils <span class="im">import</span> get_cluster_labels, get_ds_iters</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.waffle_plot <span class="im">import</span> waffle_plot</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">#from src.plot_utils import get_plot_configs</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_configs = get_plot_configs()</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.rcParams.update(plot_configs)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="define-functions" class="level2">
<h2 class="anchored" data-anchor-id="define-functions">Define Functions</h2>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_labelled_cluster(axis, <span class="bu">file</span>, sshot_idx):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    cmap_label <span class="op">=</span> plt.get_cmap(name<span class="op">=</span><span class="st">"gnuplot"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#cmap_label = 'cmc.acton'</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    labelled, _ <span class="op">=</span> get_cluster_labels(<span class="bu">file</span>, sshot_idx)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    axis.matshow(labelled, cmap<span class="op">=</span>cmap_label)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> axis</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_biggest_cluster(img):</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    kernel <span class="op">=</span> [[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>], [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>]]</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    labelled, _ <span class="op">=</span> ndimage.label(img, structure<span class="op">=</span>kernel)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    lb <span class="op">=</span> labelled.flatten()</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    cluster_sizes <span class="op">=</span> np.bincount(lb)[<span class="dv">1</span>:]</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    biggest_cluster_id <span class="op">=</span> np.argmax(cluster_sizes)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    loc <span class="op">=</span> ndimage.find_objects(labelled)[biggest_cluster_id]</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    labelled_crop <span class="op">=</span> labelled[loc]</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    img_crop <span class="op">=</span> img[loc]</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    labelled_crop[labelled_crop <span class="op">!=</span> biggest_cluster_id<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    labelled_crop[labelled_crop <span class="op">==</span> biggest_cluster_id<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    img_crop <span class="op">*=</span> labelled_crop</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> img_crop, ndimage.center_of_mass(labelled_crop)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_edges(img,axis):</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    img_threshold <span class="op">=</span> np.zeros_like(img)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    img_threshold[img <span class="op">&gt;</span> <span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    edges <span class="op">=</span> ndimage.sobel(img_threshold, axis<span class="op">=</span>axis)</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">#edges[edges &gt; -2] = 0</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">#edges[edges != 0] = 1</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    edges <span class="op">*=</span> img</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> edges</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> map_ori(ori):</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    ori_mapped <span class="op">=</span> np.zeros_like(ori, dtype<span class="op">=</span>np.float_)</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    ori_mapped[ori <span class="op">==</span> <span class="dv">1</span>] <span class="op">=</span> np.pi</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    ori_mapped[ori <span class="op">==</span> <span class="dv">2</span>] <span class="op">=</span> np.pi<span class="op">/</span><span class="dv">2</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>    ori_mapped[ori <span class="op">==</span> <span class="dv">3</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>    ori_mapped[ori <span class="op">==</span> <span class="dv">4</span>] <span class="op">=</span> <span class="op">-</span>np.pi<span class="op">/</span><span class="dv">2</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ori_mapped</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> map_ori_human(ori):</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>    ori_mapped <span class="op">=</span> np.zeros_like(ori, dtype<span class="op">=</span>np.dtype(<span class="st">'U100'</span>))</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>    ori_mapped[ori <span class="op">==</span> <span class="dv">3</span>] <span class="op">=</span> <span class="st">"Down"</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>    ori_mapped[ori <span class="op">==</span> <span class="dv">2</span>] <span class="op">=</span> <span class="st">"Right"</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>    ori_mapped[ori <span class="op">==</span> <span class="dv">1</span>] <span class="op">=</span> <span class="st">"Up"</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>    ori_mapped[ori <span class="op">==</span> <span class="dv">4</span>] <span class="op">=</span> <span class="st">"Left"</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ori_mapped</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a><span class="co"># 0: y, 1: x</span></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_ori_and_loc(edges,com):</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">=</span> edges.nonzero()</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>    edges_ori <span class="op">=</span> map_ori(edges[positions[<span class="dv">0</span>],positions[<span class="dv">1</span>]])</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>    edges_loc <span class="op">=</span> np.arctan2((com[<span class="dv">0</span>]<span class="op">-</span>positions[<span class="dv">0</span>]),(positions[<span class="dv">1</span>]<span class="op">-</span>com[<span class="dv">1</span>]))</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CHECK CODE</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># colors = ListedColormap(["k", "r", "yellow", "g", "b"])</span></span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># edges[edges == 0] = -4</span></span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># edges[positions[0],positions[1]] = edges_loc</span></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>    plt.matshow(edges)</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>    plt.colorbar()</span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>    plt.axvline(com[<span class="dv">1</span>], c<span class="op">=</span><span class="st">'w'</span>)</span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>    plt.axhline(com[<span class="dv">0</span>], c<span class="op">=</span><span class="st">'w'</span>)</span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> edges_ori, edges_loc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="plot-cluster-map" class="level2">
<h2 class="anchored" data-anchor-id="plot-cluster-map">Plot Cluster Map</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>mpl.rcParams.update(mpl.rcParamsDefault)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>sshot_idx <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">3</span>), constrained_layout<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> plot_labelled_cluster(ax1, <span class="st">"../data/no-rolling/dataset_tumble_0.016_density_0.4.h5"</span>, sshot_idx)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>ax1.text(</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=-</span><span class="fl">0.1</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>ax1.transAxes,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    ha<span class="op">=</span><span class="st">"right"</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span><span class="vs">r"$\alpha = 0.016$"</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plot_labelled_cluster(ax2, <span class="st">"../data/no-rolling/dataset_tumble_0.340_density_0.4.h5"</span>, sshot_idx)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>ax2.text(</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=-</span><span class="fl">0.1</span>,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>ax2.transAxes,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    ha<span class="op">=</span><span class="st">"right"</span>,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span><span class="vs">r"$\alpha = 0.340$"</span>,</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>fig.savefig(<span class="st">"../plots/cluster_orientation_analysis/cluster_map.svg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_cluster_orientation_analysis_files/cp_cluster_orientation_analysis_6_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="get-frequency-of-up-down-edge-orientations" class="level2">
<h2 class="anchored" data-anchor-id="get-frequency-of-up-down-edge-orientations">Get Frequency of Up-Down Edge Orientations</h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>hf <span class="op">=</span> h5py.File(<span class="ss">f"../data/no-rolling/dataset_tumble_0.016_density_0.4.h5"</span>, <span class="st">"r"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>iters <span class="op">=</span> get_ds_iters(hf.keys())</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> hf[<span class="ss">f"conf_</span><span class="sc">{</span>iters[<span class="dv">300</span>]<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> np.array(img)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> get_edges(img, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>img2[img2<span class="op">&lt;</span><span class="dv">0</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>img2[img2<span class="op">&gt;</span><span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>locs_neg <span class="op">=</span> np.where(img2 <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>locs_mid <span class="op">=</span> np.where(img2 <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>locs_pos <span class="op">=</span> np.where(img2 <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>neg <span class="op">=</span> img[locs_neg[<span class="dv">0</span>][:],locs_neg[<span class="dv">1</span>][:]]</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>mid <span class="op">=</span> img[locs_mid[<span class="dv">0</span>][:],locs_mid[<span class="dv">1</span>][:]]</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>pos <span class="op">=</span> img[locs_pos[<span class="dv">0</span>][:],locs_pos[<span class="dv">1</span>][:]]</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> np.column_stack((np.bincount(neg),np.bincount(pos)))[<span class="dv">1</span>:]</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Grad'</span>: ([<span class="st">"Negative"</span>]<span class="op">+</span>[<span class="st">"Positive"</span>])<span class="op">*</span><span class="dv">4</span>,</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Orientation'</span>: pd.Categorical(</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"Up"</span>, <span class="st">"Up"</span>, <span class="st">"Right"</span>, <span class="st">"Right"</span>, <span class="st">"Down"</span>, <span class="st">"Down"</span>, <span class="st">"Left"</span>, <span class="st">"Left"</span>],</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>        categories<span class="op">=</span>[<span class="st">"Left"</span>, <span class="st">"Up"</span>, <span class="st">"Right"</span>, <span class="st">"Down"</span>]</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Frequency'</span>: counts.flatten(),</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">"cache/updown_ori_freq.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="get-frequency-of-left-right-edge-orientations" class="level2">
<h2 class="anchored" data-anchor-id="get-frequency-of-left-right-edge-orientations">Get Frequency of Left-Right Edge Orientations</h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>hf <span class="op">=</span> h5py.File(<span class="ss">f"../data/no-rolling/dataset_tumble_0.016_density_0.4.h5"</span>, <span class="st">"r"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>iters <span class="op">=</span> get_ds_iters(hf.keys())</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> hf[<span class="ss">f"conf_</span><span class="sc">{</span>iters[<span class="dv">300</span>]<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> np.array(img)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> get_edges(img, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>img2[img2<span class="op">&lt;</span><span class="dv">0</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>img2[img2<span class="op">&gt;</span><span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>locs_neg <span class="op">=</span> np.where(img2 <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>locs_mid <span class="op">=</span> np.where(img2 <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>locs_pos <span class="op">=</span> np.where(img2 <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>neg <span class="op">=</span> img[locs_neg[<span class="dv">0</span>][:],locs_neg[<span class="dv">1</span>][:]]</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>mid <span class="op">=</span> img[locs_mid[<span class="dv">0</span>][:],locs_mid[<span class="dv">1</span>][:]]</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>pos <span class="op">=</span> img[locs_pos[<span class="dv">0</span>][:],locs_pos[<span class="dv">1</span>][:]]</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> np.column_stack((np.bincount(neg),np.bincount(pos)))[<span class="dv">1</span>:]</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Grad'</span>: ([<span class="st">"Negative"</span>]<span class="op">+</span>[<span class="st">"Positive"</span>])<span class="op">*</span><span class="dv">4</span>,</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>   <span class="st">'Orientation'</span>: pd.Categorical(</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>       [<span class="st">"Up"</span>, <span class="st">"Up"</span>, <span class="st">"Right"</span>, <span class="st">"Right"</span>, <span class="st">"Down"</span>, <span class="st">"Down"</span>, <span class="st">"Left"</span>, <span class="st">"Left"</span>],</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>       categories<span class="op">=</span>[<span class="st">"Left"</span>, <span class="st">"Up"</span>, <span class="st">"Right"</span>, <span class="st">"Down"</span>]</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>   ),</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Frequency'</span>: counts.flatten(),</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">"cache/leftright_ori_freq.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="get-frequency-of-up-down-scrambled-edge-orientations" class="level2">
<h2 class="anchored" data-anchor-id="get-frequency-of-up-down-scrambled-edge-orientations">Get Frequency of Up-Down Scrambled Edge Orientations</h2>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>hf <span class="op">=</span> h5py.File(<span class="ss">f"../data/no-rolling/dataset_tumble_0.016_density_0.4.h5"</span>, <span class="st">"r"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>iters <span class="op">=</span> get_ds_iters(hf.keys())</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> hf[<span class="ss">f"conf_</span><span class="sc">{</span>iters[<span class="dv">300</span>]<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> np.array(img)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>img[img <span class="op">&gt;</span> <span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> img <span class="op">*</span> np.random.randint(<span class="dv">1</span>, <span class="dv">5</span>, size<span class="op">=</span>(<span class="dv">128</span>, <span class="dv">128</span>))</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> get_edges(img, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>img2[img2<span class="op">&lt;</span><span class="dv">0</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>img2[img2<span class="op">&gt;</span><span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>locs_neg <span class="op">=</span> np.where(img2 <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>locs_mid <span class="op">=</span> np.where(img2 <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>locs_pos <span class="op">=</span> np.where(img2 <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>neg <span class="op">=</span> img[locs_neg[<span class="dv">0</span>][:],locs_neg[<span class="dv">1</span>][:]]</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>mid <span class="op">=</span> img[locs_mid[<span class="dv">0</span>][:],locs_mid[<span class="dv">1</span>][:]]</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>pos <span class="op">=</span> img[locs_pos[<span class="dv">0</span>][:],locs_pos[<span class="dv">1</span>][:]]</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> np.column_stack((np.bincount(neg),np.bincount(pos)))[<span class="dv">1</span>:]</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Grad'</span>: ([<span class="st">"Negative"</span>]<span class="op">+</span>[<span class="st">"Positive"</span>])<span class="op">*</span><span class="dv">4</span>,</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Orientation'</span>: pd.Categorical(</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"Up"</span>, <span class="st">"Up"</span>, <span class="st">"Right"</span>, <span class="st">"Right"</span>, <span class="st">"Down"</span>, <span class="st">"Down"</span>, <span class="st">"Left"</span>, <span class="st">"Left"</span>],</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>        categories<span class="op">=</span>[<span class="st">"Left"</span>, <span class="st">"Up"</span>, <span class="st">"Right"</span>, <span class="st">"Down"</span>]</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Frequency'</span>: counts.flatten(),</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">"cache/updown_ori_freq_scrambled.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="get-frequency-of-left-right-scrambled-edge-orientations" class="level2">
<h2 class="anchored" data-anchor-id="get-frequency-of-left-right-scrambled-edge-orientations">Get Frequency of Left-Right Scrambled Edge Orientations</h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>hf <span class="op">=</span> h5py.File(<span class="ss">f"../data/no-rolling/dataset_tumble_0.016_density_0.4.h5"</span>, <span class="st">"r"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>iters <span class="op">=</span> get_ds_iters(hf.keys())</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> hf[<span class="ss">f"conf_</span><span class="sc">{</span>iters[<span class="dv">300</span>]<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> np.array(img)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>img[img <span class="op">&gt;</span> <span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> img <span class="op">*</span> np.random.randint(<span class="dv">1</span>, <span class="dv">5</span>, size<span class="op">=</span>(<span class="dv">128</span>, <span class="dv">128</span>))</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> get_edges(img, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>img2[img2<span class="op">&lt;</span><span class="dv">0</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>img2[img2<span class="op">&gt;</span><span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>locs_neg <span class="op">=</span> np.where(img2 <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>locs_mid <span class="op">=</span> np.where(img2 <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>locs_pos <span class="op">=</span> np.where(img2 <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>neg <span class="op">=</span> img[locs_neg[<span class="dv">0</span>][:],locs_neg[<span class="dv">1</span>][:]]</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>mid <span class="op">=</span> img[locs_mid[<span class="dv">0</span>][:],locs_mid[<span class="dv">1</span>][:]]</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>pos <span class="op">=</span> img[locs_pos[<span class="dv">0</span>][:],locs_pos[<span class="dv">1</span>][:]]</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> np.column_stack((np.bincount(neg),np.bincount(pos)))[<span class="dv">1</span>:]</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Grad'</span>: ([<span class="st">"Negative"</span>]<span class="op">+</span>[<span class="st">"Positive"</span>])<span class="op">*</span><span class="dv">4</span>,</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Orientation'</span>: pd.Categorical(</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"Up"</span>, <span class="st">"Up"</span>, <span class="st">"Right"</span>, <span class="st">"Right"</span>, <span class="st">"Down"</span>, <span class="st">"Down"</span>, <span class="st">"Left"</span>, <span class="st">"Left"</span>],</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>        categories<span class="op">=</span>[<span class="st">"Left"</span>, <span class="st">"Up"</span>, <span class="st">"Right"</span>, <span class="st">"Down"</span>])</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    ,</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Frequency'</span>: counts.flatten(),</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">"cache/leftright_ori_freq_scrambled.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="plot-cluster-edge-orientations" class="level2">
<h2 class="anchored" data-anchor-id="plot-cluster-edge-orientations">Plot Cluster Edge Orientations</h2>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#mpl.rcParams.update(mpl.rcParamsDefault)</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"cache/leftright_ori_freq_scrambled.csv"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_configs = get_plot_configs()</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#sns.set(rc=plot_configs)</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"ticks"</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>sns.set_style({<span class="st">"xtick.direction"</span>: <span class="st">"in"</span>,<span class="st">"ytick.direction"</span>: <span class="st">"in"</span>})</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.rcParams.update(plot_configs)</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">5</span>), constrained_layout<span class="op">=</span><span class="va">True</span>,dpi<span class="op">=</span><span class="dv">600</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">#ax0 = fig.add_subplot(</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">#    1, 1, 1</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>ax4 <span class="op">=</span> fig.add_subplot(</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> fig.add_subplot(</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> fig.add_subplot(</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> fig.add_subplot(</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>hf <span class="op">=</span> h5py.File(<span class="ss">f"../data/no-rolling/dataset_tumble_0.016_density_0.4.h5"</span>, <span class="st">"r"</span>)</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>iters <span class="op">=</span> get_ds_iters(hf.keys())</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> hf[<span class="ss">f"conf_</span><span class="sc">{</span>iters[<span class="dv">300</span>]<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> np.array(img)</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>img_thres <span class="op">=</span> img</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>img_thres[img_thres<span class="op">&gt;</span><span class="dv">0</span>]<span class="op">=</span><span class="dv">1</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="co">#axins = inset_axes(ax4, width="100%", height="100%", borderpad=1)</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a><span class="co">#axins.set_axes_locator(InsetPosition(ax4, [.7, 1.3, 1, 1]))</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a><span class="co">#axins.matshow(img_thres, cmap='cmc.oslo')</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="co">#axins.tick_params(</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a><span class="co">#    axis = "both",</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="co">#    which = "both",</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="co">#    length = 0,</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a><span class="co">#    labelleft = False,</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a><span class="co">#    labeltop = False,</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> get_edges(img, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>img2[img2<span class="op">&lt;</span><span class="dv">0</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>img2[img2<span class="op">&gt;</span><span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> ax2.matshow(img2, cmap<span class="op">=</span>plt.get_cmap(cm.bam, lut<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>cb <span class="op">=</span> plt.colorbar(cbar, ax<span class="op">=</span>ax2, ticks<span class="op">=</span>np.arange(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span>), values<span class="op">=</span>np.arange(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span>), location<span class="op">=</span><span class="st">'bottom'</span>, fraction<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>cb.set_ticklabels([<span class="st">"Bottom</span><span class="ch">\n</span><span class="st">edges"</span>, <span class="st">"BG."</span>, <span class="st">"Top</span><span class="ch">\n</span><span class="st">edges"</span>])</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>    axis <span class="op">=</span> <span class="st">"both"</span>,</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>    which <span class="op">=</span> <span class="st">"both"</span>,</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>    length <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>    labelleft <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>    labeltop <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> get_edges(img, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>img2[img2<span class="op">&lt;</span><span class="dv">0</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>img2[img2<span class="op">&gt;</span><span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> ax4.matshow(img2, cmap<span class="op">=</span>plt.get_cmap(cm.bam, lut<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>cb <span class="op">=</span> plt.colorbar(cbar, ax<span class="op">=</span>ax4, ticks<span class="op">=</span>np.arange(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span>), values<span class="op">=</span>np.arange(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span>), location<span class="op">=</span><span class="st">'bottom'</span>, fraction<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>cb.set_ticklabels([<span class="st">"Right</span><span class="ch">\n</span><span class="st">edges"</span>, <span class="st">"BG."</span>, <span class="st">"Left</span><span class="ch">\n</span><span class="st">edges"</span>])</span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>ax4.tick_params(</span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>    axis <span class="op">=</span> <span class="st">"both"</span>,</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>    which <span class="op">=</span> <span class="st">"both"</span>,</span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>    length <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>    labelleft <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>    labeltop <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> {<span class="st">'Negative'</span>: <span class="st">'#0C4B00'</span>, <span class="st">'Positive'</span>: <span class="st">'#65024B'</span> }</span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"cache/updown_ori_freq.csv"</span>)</span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a>sns.barplot(ax<span class="op">=</span>ax1, data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'Orientation'</span>,y<span class="op">=</span><span class="st">'Frequency'</span>, hue<span class="op">=</span><span class="st">'Grad'</span>, palette<span class="op">=</span>palette, legend<span class="op">=</span><span class="va">False</span>, width<span class="op">=</span><span class="fl">0.7</span>, order<span class="op">=</span>[<span class="st">"Up"</span>,<span class="st">"Down"</span>,<span class="st">"Left"</span>,<span class="st">"Right"</span>])</span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>ax1.<span class="bu">set</span>(xticklabels<span class="op">=</span>[])</span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a><span class="co">#df = pd.read_csv("cache/updown_ori_freq_scrambled.csv")</span></span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a><span class="co">#sns.barplot(ax=ax2, data=df, x='Orientation',y='Frequency', hue='Grad', palette=palette)</span></span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.set(xlabel=None, xticklabels=[], ylabel=None, yticklabels=[])</span></span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a><span class="co">#sns.move_legend(ax2, "upper right", bbox_to_anchor=(1, 1.1), frameon=False, title=r"Gradient")</span></span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"cache/leftright_ori_freq.csv"</span>)</span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a>sns.barplot(ax<span class="op">=</span>ax3, data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'Orientation'</span>,y<span class="op">=</span><span class="st">'Frequency'</span>, hue<span class="op">=</span><span class="st">'Grad'</span>, palette<span class="op">=</span>palette, legend<span class="op">=</span><span class="va">False</span>, width<span class="op">=</span><span class="fl">0.7</span>, order<span class="op">=</span>[<span class="st">"Up"</span>,<span class="st">"Down"</span>,<span class="st">"Left"</span>,<span class="st">"Right"</span>])</span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a><span class="co">#df = pd.read_csv("cache/leftright_ori_freq_scrambled.csv")</span></span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a><span class="co">#sns.barplot(ax=ax5, data=df, x='Orientation',y='Frequency', hue='Grad', palette=palette, legend=False)</span></span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a><span class="co">#ax5.set(yticklabels=[])</span></span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, ax <span class="kw">in</span> <span class="bu">enumerate</span>((ax1,ax3)):</span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a>    sns.despine(ax<span class="op">=</span>ax)</span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(<span class="dv">0</span>,<span class="dv">1100</span>)</span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="va">None</span>, ylabel<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a>    ax.set_xticklabels([<span class="st">"↑"</span>,<span class="st">"↓"</span>,<span class="st">"→"</span>,<span class="st">"←"</span>])</span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ax.set_ylabel('Particle count', fontsize=14)</span></span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">"Particle orientation"</span>)</span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true" tabindex="-1"></a>ax4.set_title(<span class="st">"Vertical Filter"</span>)</span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"Horizontal Filter"</span>)</span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true" tabindex="-1"></a><span class="co">#fig.text(s="(A)",x=0.17, y=0.95)</span></span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true" tabindex="-1"></a><span class="co">#fig.text(s="(B)",x=0.52, y=0.95, backgroundcolor=(1,1,1,0.95))</span></span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true" tabindex="-1"></a><span class="co">#fig.text(s="(C)",x=0.17, y=0.48)</span></span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true" tabindex="-1"></a><span class="co">#fig.text(s="(D)",x=0.52, y=0.48, backgroundcolor=(1,1,1,0.95))</span></span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true" tabindex="-1"></a>fig.savefig(<span class="st">"../plots/cluster_orientation_analysis/cluster_edge_orientations.png"</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>/tmp/ipykernel_13085/2311038860.py:93: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
  ax.set_xticklabels(["↑","↓","→","←"])
/tmp/ipykernel_13085/2311038860.py:93: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
  ax.set_xticklabels(["↑","↓","→","←"])</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_cluster_orientation_analysis_files/cp_cluster_orientation_analysis_16_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="plot-waffle-plot-distribution-for-horizontal-filter" class="level2">
<h2 class="anchored" data-anchor-id="plot-waffle-plot-distribution-for-horizontal-filter">Plot Waffle Plot Distribution For Horizontal Filter</h2>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"cache/updown_ori_freq.csv"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>sns.barplot(ax<span class="op">=</span>ax1, data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'Orientation'</span>,y<span class="op">=</span><span class="st">'Frequency'</span>, hue<span class="op">=</span><span class="st">'Grad'</span>, palette<span class="op">=</span>palette, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>ax1.<span class="bu">set</span>(xticklabels<span class="op">=</span>[])</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>waffle_plot(df[df[<span class="st">'Grad'</span>] <span class="op">==</span> <span class="st">"Positive"</span>][<span class="st">'Orientation'</span>], df[df[<span class="st">'Grad'</span>] <span class="op">==</span> <span class="st">"Positive"</span>][<span class="st">'Frequency'</span>], cmap<span class="op">=</span>cm.lipari)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>waffle_plot(df[df[<span class="st">'Grad'</span>] <span class="op">==</span> <span class="st">"Negative"</span>][<span class="st">'Orientation'</span>], df[df[<span class="st">'Grad'</span>] <span class="op">==</span> <span class="st">"Negative"</span>][<span class="st">'Frequency'</span>], cmap<span class="op">=</span>cm.lipari)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_cluster_orientation_analysis_files/cp_cluster_orientation_analysis_18_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_cluster_orientation_analysis_files/cp_cluster_orientation_analysis_18_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="frequency-comparison" class="level2">
<h2 class="anchored" data-anchor-id="frequency-comparison">Frequency Comparison</h2>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"cache/updown_ori_freq.csv"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.read_csv(<span class="st">"cache/updown_ori_freq_scrambled.csv"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>df3 <span class="op">=</span> pd.read_csv(<span class="st">"cache/leftright_ori_freq.csv"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>df4 <span class="op">=</span> pd.read_csv(<span class="st">"cache/leftright_ori_freq_scrambled.csv"</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>diff1 <span class="op">=</span> (df[df[<span class="st">'Grad'</span>] <span class="op">==</span> <span class="st">"Positive"</span>][<span class="st">'Frequency'</span>].values <span class="op">-</span> df[df[<span class="st">'Grad'</span>] <span class="op">==</span> <span class="st">"Negative"</span>][<span class="st">'Frequency'</span>].values)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>diff1[[<span class="dv">1</span>,<span class="dv">2</span>]] <span class="op">=</span> diff1[[<span class="dv">2</span>,<span class="dv">1</span>]]</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>diff2 <span class="op">=</span> (df3[df3[<span class="st">'Grad'</span>] <span class="op">==</span> <span class="st">"Positive"</span>][<span class="st">'Frequency'</span>].values <span class="op">-</span> df3[df3[<span class="st">'Grad'</span>] <span class="op">==</span> <span class="st">"Negative"</span>][<span class="st">'Frequency'</span>].values)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>diff2[[<span class="dv">1</span>,<span class="dv">2</span>]] <span class="op">=</span> diff2[[<span class="dv">2</span>,<span class="dv">1</span>]]</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>diff3 <span class="op">=</span> (df2[df2[<span class="st">'Grad'</span>] <span class="op">==</span> <span class="st">"Positive"</span>][<span class="st">'Frequency'</span>].values <span class="op">-</span> df2[df2[<span class="st">'Grad'</span>] <span class="op">==</span> <span class="st">"Negative"</span>][<span class="st">'Frequency'</span>].values)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>diff3[[<span class="dv">1</span>,<span class="dv">2</span>]] <span class="op">=</span> diff3[[<span class="dv">2</span>,<span class="dv">1</span>]]</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>diff4 <span class="op">=</span> (df4[df4[<span class="st">'Grad'</span>] <span class="op">==</span> <span class="st">"Positive"</span>][<span class="st">'Frequency'</span>].values <span class="op">-</span> df4[df4[<span class="st">'Grad'</span>] <span class="op">==</span> <span class="st">"Negative"</span>][<span class="st">'Frequency'</span>].values)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>diff4[[<span class="dv">1</span>,<span class="dv">2</span>]] <span class="op">=</span> diff4[[<span class="dv">2</span>,<span class="dv">1</span>]]</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>ori <span class="op">=</span> np.array([<span class="st">"Up"</span>, <span class="st">"Left"</span>, <span class="st">"Down"</span>, <span class="st">"Right"</span>])</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>ori[[<span class="dv">1</span>,<span class="dv">2</span>]] <span class="op">=</span> ori[[<span class="dv">2</span>,<span class="dv">1</span>]]</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(np.tile(ori,<span class="dv">2</span>))</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>diff_v <span class="op">=</span> pd.DataFrame({</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Difference"</span>: np.concatenate((</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>        diff1,</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>        diff2</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Orientation"</span>: np.tile(ori,<span class="dv">2</span>),</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Context'</span>: ([<span class="st">"Vertical filter"</span>]<span class="op">*</span><span class="dv">4</span><span class="op">+</span>[<span class="st">"Horizontal filter"</span>]<span class="op">*</span><span class="dv">4</span>)<span class="op">*</span><span class="dv">1</span>,</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>diff_v2 <span class="op">=</span> pd.DataFrame({</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Difference"</span>: np.concatenate((</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>        diff3,</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>        diff4,</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Orientation"</span>: np.tile(ori,<span class="dv">2</span>),</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Context'</span>: ([<span class="st">"Vertical filter"</span>]<span class="op">*</span><span class="dv">4</span><span class="op">+</span>[<span class="st">"Horizontal filter"</span>]<span class="op">*</span><span class="dv">4</span>)<span class="op">*</span><span class="dv">1</span>,</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>,<span class="dv">5</span>), constrained_layout<span class="op">=</span><span class="va">True</span>,dpi<span class="op">=</span><span class="dv">600</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> sns.barplot(data<span class="op">=</span>diff_v, x<span class="op">=</span><span class="st">'Orientation'</span>,y<span class="op">=</span><span class="st">'Difference'</span>, palette<span class="op">=</span><span class="st">'cmc.tokyo'</span>, hue<span class="op">=</span><span class="st">'Context'</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>sns.move_legend(ax1, <span class="st">"lower center"</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.5</span>, <span class="fl">0.1</span>), frameon<span class="op">=</span><span class="va">False</span>, title<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>ax1.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">"Difference between opposing edges"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>[Text(0, 0.5, 'Difference between opposing edges')]</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_cluster_orientation_analysis_files/cp_cluster_orientation_analysis_21_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
</section>
<section id="feature-map-analysis-orientation-data-type" class="level1">
<h1>6. Feature Map Analysis (Orientation Data Type)</h1>
<section id="import-libraries-3" class="level2">
<h2 class="anchored" data-anchor-id="import-libraries-3">Import Libraries</h2>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.applications.vgg16 <span class="im">import</span> preprocess_input</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.preprocessing.image <span class="im">import</span> img_to_array</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> Model</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cmcrameri <span class="im">import</span> cm</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> expand_dims</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">'./..'</span>)</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.utils <span class="im">import</span> get_cluster_labels, get_ds_iters</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.training_utils <span class="im">import</span> (</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    data_load,</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    split_dataset,</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.plot_utils <span class="im">import</span> get_plot_configs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>2024-04-08 22:29:35.720088: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2024-04-08 22:29:36.831818: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT</code></pre>
</section>
<section id="load-datasets" class="level2">
<h2 class="anchored" data-anchor-id="load-datasets">Load Datasets</h2>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>hf <span class="op">=</span> h5py.File(<span class="ss">f"../data/no-rolling/dataset_tumble_0.050_density_0.25.h5"</span>, <span class="st">"r"</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>iters <span class="op">=</span> get_ds_iters(hf.keys())</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> hf[<span class="ss">f"conf_</span><span class="sc">{</span>iters[<span class="dv">300</span>]<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> np.array(img)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> img.reshape((img.shape[<span class="dv">0</span>], img.shape[<span class="dv">1</span>], <span class="dv">1</span>))</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>hf <span class="op">=</span> h5py.File(<span class="ss">f"../data/no-rolling/dataset_tumble_0.157_density_0.25.h5"</span>, <span class="st">"r"</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>iters <span class="op">=</span> get_ds_iters(hf.keys())</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> hf[<span class="ss">f"conf_</span><span class="sc">{</span>iters[<span class="dv">300</span>]<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> np.array(img2)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> img2.reshape((img2.shape[<span class="dv">0</span>], img2.shape[<span class="dv">1</span>], <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="example-datamaps-p_t-in-0.0500.157-rho-0.25" class="level2">
<h2 class="anchored" data-anchor-id="example-datamaps-p_t-in-0.0500.157-rho-0.25">Example Datamaps (<span class="math inline">\(P_t \in \{ 0.050,0.157\}\)</span>, <span class="math inline">\(\rho = 0.25\)</span>)</h2>
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>plt.matshow(img, cmap<span class="op">=</span><span class="st">'cmc.lajolla'</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>plt.xticks([])</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>plt.yticks([])</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'../plots/fmaps/input_0.050.svg'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>, pad_inches<span class="op">=-</span><span class="fl">0.1</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>plt.matshow(img2, cmap<span class="op">=</span><span class="st">'cmc.lajolla'</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>plt.xticks([])</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>plt.yticks([])</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'../plots/fmaps/input_0.157.svg'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>, pad_inches<span class="op">=-</span><span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_7_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_7_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="set-up-gpu-and-load-model" class="level2">
<h2 class="anchored" data-anchor-id="set-up-gpu-and-load-model">Set Up GPU and Load Model</h2>
<p>Reminder: the following commands need to be ran in console in order to employ GPU. This is not strictly necessary here, since running on the CPU only affects performance (and we are computing very little data here). This is nonetheless a good habit.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">CUDNN_PATH</span><span class="op">=</span><span class="va">$(</span><span class="fu">dirname</span> <span class="va">$(</span><span class="ex">python</span> <span class="at">-c</span> <span class="st">"import nvidia.cudnn;print(nvidia.cudnn.__file__)"</span><span class="va">))</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">LD_LIBRARY_PATH</span><span class="op">=</span><span class="va">${CUDNN_PATH}</span>/lib</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">PATH</span><span class="op">=</span>/usr/local/nvidia/bin:/usr/local/cuda/bin:<span class="va">$PATH</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> tf.keras.models.load_model(<span class="st">'../models/orientation0216.keras'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>2024-04-08 22:29:40.971354: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-08 22:29:41.033494: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-08 22:29:41.034172: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-08 22:29:41.036429: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-08 22:29:41.036836: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-08 22:29:41.037016: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-08 22:29:41.144116: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-08 22:29:41.144449: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-08 22:29:41.144621: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-08 22:29:41.144752: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 4784 MB memory:  -&gt; device: 0, name: NVIDIA GeForce RTX 2060, pci bus id: 0000:01:00.0, compute capability: 7.5</code></pre>
</section>
<section id="plot-feature-maps" class="level2">
<h2 class="anchored" data-anchor-id="plot-feature-maps">Plot Feature Maps</h2>
<p>The following shows output feature maps from each architecture layer (indicated in titles). Row 0 is low tumbling rate (<span class="math inline">\(P_t=0.050\)</span>), row 1 is high tumbling rate (<span class="math inline">\(P_t=0.157\)</span>). Multiple columns indicates multiple emergent feature maps (decided by number of filters) from however many input feature maps the layer takes (dictated by previous layer output maps).</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> model_mapper (img,img2,model,layer_number,shift<span class="op">=</span><span class="va">None</span>,ncols<span class="op">=</span><span class="dv">3</span>,post_avgpool<span class="op">=</span><span class="va">False</span>,flattened<span class="op">=</span><span class="va">False</span>,output<span class="op">=</span><span class="va">False</span>,path<span class="op">=</span><span class="ss">f"../plots/fmaps/"</span>):</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    model_mini <span class="op">=</span> Model(inputs<span class="op">=</span>model.inputs, outputs<span class="op">=</span>model.layers[layer_number].output)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    feature_maps1 <span class="op">=</span> model_mini.predict(img, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    feature_maps2 <span class="op">=</span> model_mini.predict(img2, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> post_avgpool <span class="op">==</span> <span class="va">False</span> <span class="kw">and</span> flattened <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>        j <span class="op">=</span> ncols</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(i):</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> jdx <span class="kw">in</span> <span class="bu">range</span>(j):</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>                ax <span class="op">=</span> plt.subplot(i, j, idx<span class="op">*</span>j<span class="op">+</span>jdx<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>                ax.set_xticks([])</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>                ax.set_yticks([])</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>                    plt.imshow(feature_maps1[:shift, :, <span class="dv">0</span>, jdx], cmap<span class="op">=</span><span class="st">'cmc.lajolla'</span>)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>                    plt.imshow(feature_maps2[:shift, :, <span class="dv">0</span>, jdx], cmap<span class="op">=</span><span class="st">'cmc.lajolla'</span>)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> output <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>            plt.savefig(path<span class="op">+</span><span class="ss">f"layer_</span><span class="sc">{</span>layer_number<span class="sc">}</span><span class="ss">.svg"</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> post_avgpool <span class="op">==</span> <span class="va">True</span> <span class="kw">and</span> flattened <span class="op">==</span> <span class="va">False</span>: <span class="co">#plots images which do not output multiple filters</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>        plt.matshow(feature_maps1[:, :],cmap<span class="op">=</span><span class="st">'cmc.lajolla'</span>)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>        plt.xticks([])</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>        plt.yticks([])</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> output <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>            plt.savefig(path<span class="op">+</span><span class="ss">f"layer_</span><span class="sc">{</span>layer_number<span class="sc">}</span><span class="ss">_im1.svg"</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>        plt.matshow(feature_maps2[:, :],cmap<span class="op">=</span><span class="st">'cmc.lajolla'</span>)</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>        plt.xticks([])</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>        plt.yticks([])</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> output <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>            plt.savefig(path<span class="op">+</span><span class="ss">f"layer_</span><span class="sc">{</span>layer_number<span class="sc">}</span><span class="ss">_im2.svg"</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> post_avgpool <span class="op">==</span> <span class="va">True</span> <span class="kw">and</span> flattened <span class="op">==</span> <span class="va">True</span>: <span class="co">#rotates images which do not output multiple filters provided they are flattened (turns vertical to horizontal)</span></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>        plt.matshow(np.rot90(feature_maps1[:, :]),cmap<span class="op">=</span><span class="st">'cmc.lajolla'</span>)</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>        plt.xticks([])</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>        plt.yticks([])</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> output <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>            plt.savefig(path<span class="op">+</span><span class="ss">f"layer_</span><span class="sc">{</span>layer_number<span class="sc">}</span><span class="ss">_im1.svg"</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>        plt.matshow(np.rot90(feature_maps2[:, :]),cmap<span class="op">=</span><span class="st">'cmc.lajolla'</span>)</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>        plt.xticks([])</span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>        plt.yticks([])</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> output <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>            plt.savefig(path<span class="op">+</span><span class="ss">f"layer_</span><span class="sc">{</span>layer_number<span class="sc">}</span><span class="ss">_im2.svg"</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> kernel_printer(model,layer_number<span class="op">=</span><span class="dv">0</span>,path<span class="op">=</span><span class="ss">f"../plots/fmaps/"</span>):</span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>    filters, biases <span class="op">=</span> model.layers[layer_number].get_weights()</span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (filters.shape[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(filters.shape[<span class="op">-</span><span class="dv">1</span>]):</span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>        f <span class="op">=</span> filters[:, :, :, k]</span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>        plt.matshow(f[:,:,<span class="dv">0</span>],cmap<span class="op">=</span><span class="st">"cmc.lajolla"</span>)</span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>        plt.xticks([])</span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>        plt.yticks([])</span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>        plt.savefig(path<span class="op">+</span><span class="ss">f"kernel_</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">_layer_</span><span class="sc">{</span>layer_number<span class="sc">}</span><span class="ss">.svg"</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="conv-filters3kernel_size33paddingsameinput_shapeshape" class="level3">
<h3 class="anchored" data-anchor-id="conv-filters3kernel_size33paddingsameinput_shapeshape">1. CONV (filters=3,kernel_size=(3,3),padding=‘same’,input_shape=shape)</h3>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="va">None</span>,layer_number<span class="op">=</span><span class="dv">0</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1712604581.825443    9317 service.cc:145] XLA service 0x78b0500035e0 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
I0000 00:00:1712604581.825508    9317 service.cc:153]   StreamExecutor device (0): NVIDIA GeForce RTX 2060, Compute Capability 7.5
2024-04-08 22:29:41.880682: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8907
I0000 00:00:1712604582.252356    9317 device_compiler.h:188] Compiled cluster using XLA!  This line is logged at most once for the lifetime of the process.</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_15_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<section id="computed-with-the-following-kernels" class="level4">
<h4 class="anchored" data-anchor-id="computed-with-the-following-kernels">Computed with the Following Kernels</h4>
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>kernel_printer(model,layer_number<span class="op">=</span><span class="dv">0</span>,path<span class="op">=</span><span class="ss">f"../plots/fmaps/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>3</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_17_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_17_2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_17_3.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
</section>
<section id="maxpool-pool_size22paddingsame" class="level3">
<h3 class="anchored" data-anchor-id="maxpool-pool_size22paddingsame">2. MAXPOOL (pool_size=(2,2),padding=‘same’)</h3>
<div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">64</span>,layer_number<span class="op">=</span><span class="dv">1</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_19_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="relu" class="level3">
<h3 class="anchored" data-anchor-id="relu">3. ReLU</h3>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">64</span>,layer_number<span class="op">=</span><span class="dv">2</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>2024-04-08 22:29:44.564777: I tensorflow/compiler/mlir/tensorflow/utils/dump_mlir_util.cc:268] disabling MLIR crash reproducer, set env var `MLIR_CRASH_REPRODUCER_DIRECTORY` to enable.</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_21_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="bn" class="level3">
<h3 class="anchored" data-anchor-id="bn">4. BN</h3>
<div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">64</span>,layer_number<span class="op">=</span><span class="dv">3</span>,output<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_23_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="conv-filters4kernel_size55paddingsame" class="level3">
<h3 class="anchored" data-anchor-id="conv-filters4kernel_size55paddingsame">5. CONV (filters=4,kernel_size=(5,5),padding=‘same’)</h3>
<div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">64</span>,ncols<span class="op">=</span><span class="dv">4</span>,layer_number<span class="op">=</span><span class="dv">4</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_25_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<section id="computed-with-the-following-kernels-1" class="level4">
<h4 class="anchored" data-anchor-id="computed-with-the-following-kernels-1">Computed with the Following Kernels</h4>
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>kernel_printer(model,layer_number<span class="op">=</span><span class="dv">4</span>,path<span class="op">=</span><span class="ss">f"../plots/fmaps/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>4</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_27_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_27_2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_27_3.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_27_4.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
</section>
<section id="maxpool-pool_size22paddingsame-1" class="level3">
<h3 class="anchored" data-anchor-id="maxpool-pool_size22paddingsame-1">6. MAXPOOL (pool_size=(2,2),padding=‘same’)</h3>
<div class="sourceCode" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">32</span>,ncols<span class="op">=</span><span class="dv">4</span>,layer_number<span class="op">=</span><span class="dv">5</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_29_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="relu-1" class="level3">
<h3 class="anchored" data-anchor-id="relu-1">7. ReLU</h3>
<div class="sourceCode" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">32</span>,ncols<span class="op">=</span><span class="dv">4</span>,layer_number<span class="op">=</span><span class="dv">6</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_31_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="bn-1" class="level3">
<h3 class="anchored" data-anchor-id="bn-1">8. BN</h3>
<div class="sourceCode" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">32</span>,ncols<span class="op">=</span><span class="dv">4</span>,layer_number<span class="op">=</span><span class="dv">7</span>,output<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_33_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="conv-filters6-kernel_size55paddingsame" class="level3">
<h3 class="anchored" data-anchor-id="conv-filters6-kernel_size55paddingsame">9. CONV (filters=6, kernel_size=(5,5),padding=‘same’)</h3>
<div class="sourceCode" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">32</span>,ncols<span class="op">=</span><span class="dv">6</span>,layer_number<span class="op">=</span><span class="dv">8</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_35_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>kernel_printer(model,layer_number<span class="op">=</span><span class="dv">8</span>,path<span class="op">=</span><span class="ss">f"../plots/fmaps/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>6</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_36_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_36_2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_36_3.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_36_4.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_36_5.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_36_6.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="maxpool-pool_size22paddingsame-2" class="level3">
<h3 class="anchored" data-anchor-id="maxpool-pool_size22paddingsame-2">10. MAXPOOL (pool_size=(2,2),padding=‘same’)</h3>
<div class="sourceCode" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">16</span>,ncols<span class="op">=</span><span class="dv">6</span>,layer_number<span class="op">=</span><span class="dv">9</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_38_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="relu-2" class="level3">
<h3 class="anchored" data-anchor-id="relu-2">11. ReLU</h3>
<div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">16</span>,ncols<span class="op">=</span><span class="dv">6</span>,layer_number<span class="op">=</span><span class="dv">10</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_40_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="bn-2" class="level3">
<h3 class="anchored" data-anchor-id="bn-2">12. BN</h3>
<div class="sourceCode" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">16</span>,ncols<span class="op">=</span><span class="dv">6</span>,layer_number<span class="op">=</span><span class="dv">11</span>,output<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_42_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="avgpool" class="level3">
<h3 class="anchored" data-anchor-id="avgpool">13. AVGPOOL</h3>
<div class="sourceCode" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,layer_number<span class="op">=</span><span class="dv">12</span>,post_avgpool<span class="op">=</span><span class="va">True</span>,flattened<span class="op">=</span><span class="va">True</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_44_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_44_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="do-0.1-without-layout-optimiser" class="level3">
<h3 class="anchored" data-anchor-id="do-0.1-without-layout-optimiser">14. DO (0.1) (without layout optimiser)</h3>
<div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,layer_number<span class="op">=</span><span class="dv">13</span>,post_avgpool<span class="op">=</span><span class="va">True</span>,flattened<span class="op">=</span><span class="va">True</span>,output<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_46_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_46_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="fc-units128activationrelu" class="level3">
<h3 class="anchored" data-anchor-id="fc-units128activationrelu">15. FC (units=128,activation=‘relu’)</h3>
<div class="sourceCode" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,layer_number<span class="op">=</span><span class="dv">14</span>,post_avgpool<span class="op">=</span><span class="va">True</span>,flattened<span class="op">=</span><span class="va">False</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_48_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_48_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="do-0.1-without-layout-optimiser-1" class="level3">
<h3 class="anchored" data-anchor-id="do-0.1-without-layout-optimiser-1">16. DO (0.1) (without layout optimiser)</h3>
<div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,layer_number<span class="op">=</span><span class="dv">15</span>,post_avgpool<span class="op">=</span><span class="va">True</span>,flattened<span class="op">=</span><span class="va">False</span>,output<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_50_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_50_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="fc-units3activationrelu" class="level3">
<h3 class="anchored" data-anchor-id="fc-units3activationrelu">17. FC (units=3,activation=‘relu’)</h3>
<div class="sourceCode" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,layer_number<span class="op">=</span><span class="dv">16</span>,post_avgpool<span class="op">=</span><span class="va">True</span>,flattened<span class="op">=</span><span class="va">True</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_52_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_52_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="flatten" class="level3">
<h3 class="anchored" data-anchor-id="flatten">18. FLATTEN</h3>
<div class="sourceCode" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,layer_number<span class="op">=</span><span class="dv">17</span>,post_avgpool<span class="op">=</span><span class="va">True</span>,flattened<span class="op">=</span><span class="va">True</span>,output<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_54_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_54_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="fc-units1activationlinear" class="level3">
<h3 class="anchored" data-anchor-id="fc-units1activationlinear">19. FC (units=1,activation=‘linear’)</h3>
<div class="sourceCode" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,layer_number<span class="op">=</span><span class="dv">18</span>,post_avgpool<span class="op">=</span><span class="va">True</span>,flattened<span class="op">=</span><span class="va">True</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_56_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_files/cp_feature_map_analysis_56_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
</section>
<section id="some-notes" class="level2">
<h2 class="anchored" data-anchor-id="some-notes">Some notes</h2>
<p>The batch normalisation layers do not display any change becase they simply renormalise the data. They are included here for completeness.</p>
<p>The dropout layers don’t actually activate during model predictions. This is a deliberate feature of Keras which we’ve leveraged; the dropout layer helps with dataset training in order to prevent overfitting, but does not eliminate further data during actual prediction applications. They are also included here for completeness.</p>
</section>
</section>
<section id="feature-map-analysis-monochrome-data-type" class="level1">
<h1>7. Feature Map Analysis (Monochrome Data Type)</h1>
<section id="import-libraries-4" class="level2">
<h2 class="anchored" data-anchor-id="import-libraries-4">Import Libraries</h2>
<div class="sourceCode" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.applications.vgg16 <span class="im">import</span> preprocess_input</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.preprocessing.image <span class="im">import</span> img_to_array</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> Model</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cmcrameri <span class="im">import</span> cm</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> expand_dims</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">'./..'</span>)</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.utils <span class="im">import</span> get_cluster_labels, get_ds_iters</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.training_utils <span class="im">import</span> (</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>    data_load,</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>    split_dataset,</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.plot_utils <span class="im">import</span> get_plot_configs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>2024-04-16 16:15:26.430617: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2024-04-16 16:15:26.456785: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2024-04-16 16:15:26.925737: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT</code></pre>
</section>
<section id="load-datasets-1" class="level2">
<h2 class="anchored" data-anchor-id="load-datasets-1">Load Datasets</h2>
<div class="sourceCode" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>hf <span class="op">=</span> h5py.File(<span class="ss">f"../data/no-rolling/dataset_tumble_0.050_density_0.25.h5"</span>, <span class="st">"r"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>iters <span class="op">=</span> get_ds_iters(hf.keys())</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> hf[<span class="ss">f"conf_</span><span class="sc">{</span>iters[<span class="dv">300</span>]<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> np.array(img)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>img[img<span class="op">&gt;</span><span class="dv">0</span>]<span class="op">=</span><span class="dv">1</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> img.reshape((img.shape[<span class="dv">0</span>], img.shape[<span class="dv">1</span>], <span class="dv">1</span>))</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>hf <span class="op">=</span> h5py.File(<span class="ss">f"../data/no-rolling/dataset_tumble_0.157_density_0.25.h5"</span>, <span class="st">"r"</span>)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>iters <span class="op">=</span> get_ds_iters(hf.keys())</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> hf[<span class="ss">f"conf_</span><span class="sc">{</span>iters[<span class="dv">300</span>]<span class="sc">}</span><span class="ss">"</span>]</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> np.array(img2)</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>img2[img2<span class="op">&gt;</span><span class="dv">0</span>]<span class="op">=</span><span class="dv">1</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>img2 <span class="op">=</span> img2.reshape((img2.shape[<span class="dv">0</span>], img2.shape[<span class="dv">1</span>], <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="example-datamaps-p_t-in-0.0500.157-rho-0.25-1" class="level2">
<h2 class="anchored" data-anchor-id="example-datamaps-p_t-in-0.0500.157-rho-0.25-1">Example Datamaps (<span class="math inline">\(P_t \in \{ 0.050,0.157\}\)</span>, <span class="math inline">\(\rho = 0.25\)</span>)</h2>
<div class="sourceCode" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>plt.matshow(img, cmap<span class="op">=</span><span class="st">'cmc.lajolla'</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>plt.xticks([])</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>plt.yticks([])</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'../plots/fmaps/input_0.050.svg'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>, pad_inches<span class="op">=-</span><span class="fl">0.1</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>plt.matshow(img2, cmap<span class="op">=</span><span class="st">'cmc.lajolla'</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>plt.xticks([])</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>plt.yticks([])</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'../plots/fmaps/input_0.157.svg'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>, pad_inches<span class="op">=-</span><span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_7_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_7_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="set-up-gpu-and-load-model-1" class="level2">
<h2 class="anchored" data-anchor-id="set-up-gpu-and-load-model-1">Set Up GPU and Load Model</h2>
<p>Reminder: the following commands need to be ran in console in order to employ GPU. This is not strictly necessary here, since running on the CPU only affects performance (and we are computing very little data here). This is nonetheless a good habit.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">CUDNN_PATH</span><span class="op">=</span><span class="va">$(</span><span class="fu">dirname</span> <span class="va">$(</span><span class="ex">python</span> <span class="at">-c</span> <span class="st">"import nvidia.cudnn;print(nvidia.cudnn.__file__)"</span><span class="va">))</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">LD_LIBRARY_PATH</span><span class="op">=</span><span class="va">${CUDNN_PATH}</span>/lib</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">PATH</span><span class="op">=</span>/usr/local/nvidia/bin:/usr/local/cuda/bin:<span class="va">$PATH</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> tf.keras.models.load_model(<span class="st">'../models/monochrome0216.keras'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>2024-04-16 16:15:29.155891: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-16 16:15:29.866598: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-16 16:15:29.866961: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-16 16:15:29.871670: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-16 16:15:29.872067: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-16 16:15:29.872279: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-16 16:15:30.087381: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-16 16:15:30.087495: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-16 16:15:30.087551: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-16 16:15:30.088606: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 6275 MB memory:  -&gt; device: 0, name: NVIDIA GeForce RTX 4060 Laptop GPU, pci bus id: 0000:01:00.0, compute capability: 8.9</code></pre>
</section>
<section id="plot-feature-maps-1" class="level2">
<h2 class="anchored" data-anchor-id="plot-feature-maps-1">Plot Feature Maps</h2>
<p>The following shows output feature maps from each architecture layer (indicated in titles). Row 0 is low tumbling rate (<span class="math inline">\(P_t=0.050\)</span>), row 1 is high tumbling rate (<span class="math inline">\(P_t=0.157\)</span>). Multiple columns indicates multiple emergent feature maps (decided by number of filters) from however many input feature maps the layer takes (dictated by previous layer output maps).</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> model_mapper (img,img2,model,layer_number,shift<span class="op">=</span><span class="va">None</span>,ncols<span class="op">=</span><span class="dv">3</span>,post_avgpool<span class="op">=</span><span class="va">False</span>,flattened<span class="op">=</span><span class="va">False</span>,output<span class="op">=</span><span class="va">False</span>,path<span class="op">=</span><span class="ss">f"../plots/fmaps/"</span>):</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    model_mini <span class="op">=</span> Model(inputs<span class="op">=</span>model.inputs, outputs<span class="op">=</span>model.layers[layer_number].output)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    feature_maps1 <span class="op">=</span> model_mini.predict(img, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    feature_maps2 <span class="op">=</span> model_mini.predict(img2, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> post_avgpool <span class="op">==</span> <span class="va">False</span> <span class="kw">and</span> flattened <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>        j <span class="op">=</span> ncols</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(i):</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> jdx <span class="kw">in</span> <span class="bu">range</span>(j):</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>                ax <span class="op">=</span> plt.subplot(i, j, idx<span class="op">*</span>j<span class="op">+</span>jdx<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>                ax.set_xticks([])</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>                ax.set_yticks([])</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> idx <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>                    plt.imshow(feature_maps1[:shift, :, <span class="dv">0</span>, jdx], cmap<span class="op">=</span><span class="st">'cmc.lajolla'</span>)</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>                    plt.imshow(feature_maps2[:shift, :, <span class="dv">0</span>, jdx], cmap<span class="op">=</span><span class="st">'cmc.lajolla'</span>)</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> output <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>            plt.savefig(path<span class="op">+</span><span class="ss">f"layer_</span><span class="sc">{</span>layer_number<span class="sc">}</span><span class="ss">.svg"</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> post_avgpool <span class="op">==</span> <span class="va">True</span> <span class="kw">and</span> flattened <span class="op">==</span> <span class="va">False</span>: <span class="co">#plots images which do not output multiple filters</span></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>        plt.matshow(feature_maps1[:, :],cmap<span class="op">=</span><span class="st">'cmc.lajolla'</span>)</span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>        plt.xticks([])</span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>        plt.yticks([])</span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> output <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>            plt.savefig(path<span class="op">+</span><span class="ss">f"layer_</span><span class="sc">{</span>layer_number<span class="sc">}</span><span class="ss">_im1.svg"</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>        plt.matshow(feature_maps2[:, :],cmap<span class="op">=</span><span class="st">'cmc.lajolla'</span>)</span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>        plt.xticks([])</span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a>        plt.yticks([])</span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> output <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a>            plt.savefig(path<span class="op">+</span><span class="ss">f"layer_</span><span class="sc">{</span>layer_number<span class="sc">}</span><span class="ss">_im2.svg"</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> post_avgpool <span class="op">==</span> <span class="va">True</span> <span class="kw">and</span> flattened <span class="op">==</span> <span class="va">True</span>: <span class="co">#rotates images which do not output multiple filters provided they are flattened (turns vertical to horizontal)</span></span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a>        plt.matshow(np.rot90(feature_maps1[:, :]),cmap<span class="op">=</span><span class="st">'cmc.lajolla'</span>)</span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a>        plt.xticks([])</span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a>        plt.yticks([])</span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> output <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a>            plt.savefig(path<span class="op">+</span><span class="ss">f"layer_</span><span class="sc">{</span>layer_number<span class="sc">}</span><span class="ss">_im1.svg"</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a>        plt.matshow(np.rot90(feature_maps2[:, :]),cmap<span class="op">=</span><span class="st">'cmc.lajolla'</span>)</span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a>        plt.xticks([])</span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a>        plt.yticks([])</span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> output <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true" tabindex="-1"></a>            plt.savefig(path<span class="op">+</span><span class="ss">f"layer_</span><span class="sc">{</span>layer_number<span class="sc">}</span><span class="ss">_im2.svg"</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb76-47"><a href="#cb76-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-48"><a href="#cb76-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-49"><a href="#cb76-49" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> kernel_printer(model,layer_number<span class="op">=</span><span class="dv">0</span>,path<span class="op">=</span><span class="ss">f"../plots/fmaps/"</span>):</span>
<span id="cb76-50"><a href="#cb76-50" aria-hidden="true" tabindex="-1"></a>    filters, biases <span class="op">=</span> model.layers[layer_number].get_weights()</span>
<span id="cb76-51"><a href="#cb76-51" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (filters.shape[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb76-52"><a href="#cb76-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(filters.shape[<span class="op">-</span><span class="dv">1</span>]):</span>
<span id="cb76-53"><a href="#cb76-53" aria-hidden="true" tabindex="-1"></a>        f <span class="op">=</span> filters[:, :, :, k]</span>
<span id="cb76-54"><a href="#cb76-54" aria-hidden="true" tabindex="-1"></a>        plt.matshow(f[:,:,<span class="dv">0</span>],cmap<span class="op">=</span><span class="st">"cmc.lajolla"</span>)</span>
<span id="cb76-55"><a href="#cb76-55" aria-hidden="true" tabindex="-1"></a>        plt.xticks([])</span>
<span id="cb76-56"><a href="#cb76-56" aria-hidden="true" tabindex="-1"></a>        plt.yticks([])</span>
<span id="cb76-57"><a href="#cb76-57" aria-hidden="true" tabindex="-1"></a>        plt.savefig(path<span class="op">+</span><span class="ss">f"kernel_</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">_layer_</span><span class="sc">{</span>layer_number<span class="sc">}</span><span class="ss">.svg"</span>,bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="conv-filters3kernel_size33paddingsameinput_shapeshape-1" class="level3">
<h3 class="anchored" data-anchor-id="conv-filters3kernel_size33paddingsameinput_shapeshape-1">1. CONV (filters=3,kernel_size=(3,3),padding=‘same’,input_shape=shape)</h3>
<div class="sourceCode" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="va">None</span>,layer_number<span class="op">=</span><span class="dv">0</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1713280530.466361    8794 service.cc:145] XLA service 0x78dc1c002cf0 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
I0000 00:00:1713280530.466396    8794 service.cc:153]   StreamExecutor device (0): NVIDIA GeForce RTX 4060 Laptop GPU, Compute Capability 8.9
2024-04-16 16:15:30.560875: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8907
I0000 00:00:1713280531.625524    8794 device_compiler.h:188] Compiled cluster using XLA!  This line is logged at most once for the lifetime of the process.</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_15_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<section id="computed-with-the-following-kernels-2" class="level4">
<h4 class="anchored" data-anchor-id="computed-with-the-following-kernels-2">Computed with the Following Kernels</h4>
<div class="sourceCode" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>kernel_printer(model,layer_number<span class="op">=</span><span class="dv">0</span>,path<span class="op">=</span><span class="ss">f"../plots/fmaps/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>3</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_17_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_17_2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_17_3.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
</section>
<section id="maxpool-pool_size22paddingsame-3" class="level3">
<h3 class="anchored" data-anchor-id="maxpool-pool_size22paddingsame-3">2. MAXPOOL (pool_size=(2,2),padding=‘same’)</h3>
<div class="sourceCode" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">64</span>,layer_number<span class="op">=</span><span class="dv">1</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_19_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="relu-3" class="level3">
<h3 class="anchored" data-anchor-id="relu-3">3. ReLU</h3>
<div class="sourceCode" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">64</span>,layer_number<span class="op">=</span><span class="dv">2</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>2024-04-16 16:15:32.456222: I tensorflow/compiler/mlir/tensorflow/utils/dump_mlir_util.cc:268] disabling MLIR crash reproducer, set env var `MLIR_CRASH_REPRODUCER_DIRECTORY` to enable.</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_21_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="bn-3" class="level3">
<h3 class="anchored" data-anchor-id="bn-3">4. BN</h3>
<div class="sourceCode" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">64</span>,layer_number<span class="op">=</span><span class="dv">3</span>,output<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_23_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="conv-filters4kernel_size55paddingsame-1" class="level3">
<h3 class="anchored" data-anchor-id="conv-filters4kernel_size55paddingsame-1">5. CONV (filters=4,kernel_size=(5,5),padding=‘same’)</h3>
<div class="sourceCode" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">64</span>,ncols<span class="op">=</span><span class="dv">4</span>,layer_number<span class="op">=</span><span class="dv">4</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_25_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<section id="computed-with-the-following-kernels-3" class="level4">
<h4 class="anchored" data-anchor-id="computed-with-the-following-kernels-3">Computed with the Following Kernels</h4>
<div class="sourceCode" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>kernel_printer(model,layer_number<span class="op">=</span><span class="dv">4</span>,path<span class="op">=</span><span class="ss">f"../plots/fmaps/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>4</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_27_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_27_2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_27_3.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_27_4.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
</section>
<section id="maxpool-pool_size22paddingsame-4" class="level3">
<h3 class="anchored" data-anchor-id="maxpool-pool_size22paddingsame-4">6. MAXPOOL (pool_size=(2,2),padding=‘same’)</h3>
<div class="sourceCode" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">32</span>,ncols<span class="op">=</span><span class="dv">4</span>,layer_number<span class="op">=</span><span class="dv">5</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_29_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="relu-4" class="level3">
<h3 class="anchored" data-anchor-id="relu-4">7. ReLU</h3>
<div class="sourceCode" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">32</span>,ncols<span class="op">=</span><span class="dv">4</span>,layer_number<span class="op">=</span><span class="dv">6</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_31_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="bn-4" class="level3">
<h3 class="anchored" data-anchor-id="bn-4">8. BN</h3>
<div class="sourceCode" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">32</span>,ncols<span class="op">=</span><span class="dv">4</span>,layer_number<span class="op">=</span><span class="dv">7</span>,output<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_33_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="conv-filters6-kernel_size55paddingsame-1" class="level3">
<h3 class="anchored" data-anchor-id="conv-filters6-kernel_size55paddingsame-1">9. CONV (filters=6, kernel_size=(5,5),padding=‘same’)</h3>
<div class="sourceCode" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">32</span>,ncols<span class="op">=</span><span class="dv">6</span>,layer_number<span class="op">=</span><span class="dv">8</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_35_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="sourceCode" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>kernel_printer(model,layer_number<span class="op">=</span><span class="dv">8</span>,path<span class="op">=</span><span class="ss">f"../plots/fmaps/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>6</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_36_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_36_2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_36_3.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_36_4.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_36_5.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_36_6.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="maxpool-pool_size22paddingsame-5" class="level3">
<h3 class="anchored" data-anchor-id="maxpool-pool_size22paddingsame-5">10. MAXPOOL (pool_size=(2,2),padding=‘same’)</h3>
<div class="sourceCode" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">16</span>,ncols<span class="op">=</span><span class="dv">6</span>,layer_number<span class="op">=</span><span class="dv">9</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_38_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="relu-5" class="level3">
<h3 class="anchored" data-anchor-id="relu-5">11. ReLU</h3>
<div class="sourceCode" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">16</span>,ncols<span class="op">=</span><span class="dv">6</span>,layer_number<span class="op">=</span><span class="dv">10</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_40_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="bn-5" class="level3">
<h3 class="anchored" data-anchor-id="bn-5">12. BN</h3>
<div class="sourceCode" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,shift<span class="op">=</span><span class="dv">16</span>,ncols<span class="op">=</span><span class="dv">6</span>,layer_number<span class="op">=</span><span class="dv">11</span>,output<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_42_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="avgpool-1" class="level3">
<h3 class="anchored" data-anchor-id="avgpool-1">13. AVGPOOL</h3>
<div class="sourceCode" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,layer_number<span class="op">=</span><span class="dv">12</span>,post_avgpool<span class="op">=</span><span class="va">True</span>,flattened<span class="op">=</span><span class="va">True</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_44_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_44_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="do-0.1-without-layout-optimiser-2" class="level3">
<h3 class="anchored" data-anchor-id="do-0.1-without-layout-optimiser-2">14. DO (0.1) (without layout optimiser)</h3>
<div class="sourceCode" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,layer_number<span class="op">=</span><span class="dv">13</span>,post_avgpool<span class="op">=</span><span class="va">True</span>,flattened<span class="op">=</span><span class="va">True</span>,output<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_46_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_46_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="fc-units128activationrelu-1" class="level3">
<h3 class="anchored" data-anchor-id="fc-units128activationrelu-1">15. FC (units=128,activation=‘relu’)</h3>
<div class="sourceCode" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,layer_number<span class="op">=</span><span class="dv">14</span>,post_avgpool<span class="op">=</span><span class="va">True</span>,flattened<span class="op">=</span><span class="va">False</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_48_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_48_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="do-0.1-without-layout-optimiser-3" class="level3">
<h3 class="anchored" data-anchor-id="do-0.1-without-layout-optimiser-3">16. DO (0.1) (without layout optimiser)</h3>
<div class="sourceCode" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,layer_number<span class="op">=</span><span class="dv">15</span>,post_avgpool<span class="op">=</span><span class="va">True</span>,flattened<span class="op">=</span><span class="va">False</span>,output<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_50_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_50_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="fc-units3activationrelu-1" class="level3">
<h3 class="anchored" data-anchor-id="fc-units3activationrelu-1">17. FC (units=3,activation=‘relu’)</h3>
<div class="sourceCode" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,layer_number<span class="op">=</span><span class="dv">16</span>,post_avgpool<span class="op">=</span><span class="va">True</span>,flattened<span class="op">=</span><span class="va">True</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_52_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_52_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="flatten-1" class="level3">
<h3 class="anchored" data-anchor-id="flatten-1">18. FLATTEN</h3>
<div class="sourceCode" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,layer_number<span class="op">=</span><span class="dv">17</span>,post_avgpool<span class="op">=</span><span class="va">True</span>,flattened<span class="op">=</span><span class="va">True</span>,output<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_54_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_54_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="fc-units1activationlinear-1" class="level3">
<h3 class="anchored" data-anchor-id="fc-units1activationlinear-1">19. FC (units=1,activation=‘linear’)</h3>
<div class="sourceCode" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>model_mapper (img,img2,model,layer_number<span class="op">=</span><span class="dv">18</span>,post_avgpool<span class="op">=</span><span class="va">True</span>,flattened<span class="op">=</span><span class="va">True</span>,output<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_56_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_feature_map_analysis_monochrome_files/cp_feature_map_analysis_monochrome_56_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
</section>
<section id="some-notes-1" class="level2">
<h2 class="anchored" data-anchor-id="some-notes-1">Some notes</h2>
<p>The batch normalisation layers do not display any change becase they simply renormalise the data. They are included here for completeness.</p>
<p>The dropout layers don’t actually activate during model predictions. This is a deliberate feature of Keras which we’ve leveraged; the dropout layer helps with dataset training in order to prevent overfitting, but does not eliminate further data during actual prediction applications. They are also included here for completeness.</p>
</section>
</section>
<section id="final-averaged-predictions" class="level1">
<h1>8. Final Averaged Predictions</h1>
<section id="import-packages" class="level2">
<h2 class="anchored" data-anchor-id="import-packages">Import packages</h2>
<div class="sourceCode" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> ticker</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> pearsonr</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">'./..'</span>)</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.training_utils <span class="im">import</span> data_load, extract_floats, split_dataset, predict_multi_by_name, plot_violin_and_statistics,cross_mean_err_calculator</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras <span class="im">import</span> backend <span class="im">as</span> K</span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dense,Conv2D,Flatten,Dropout,MaxPooling2D,BatchNormalization,AveragePooling2D,LeakyReLU,GlobalAveragePooling2D,ReLU</span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cmcrameri <span class="im">import</span> cm</span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a>np.set_printoptions(precision<span class="op">=</span><span class="dv">3</span>, suppress<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>2024-04-15 22:46:20.013183: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2024-04-15 22:46:20.126745: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2024-04-15 22:46:22.013569: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT</code></pre>
</section>
<section id="set-seed-optional" class="level2">
<h2 class="anchored" data-anchor-id="set-seed-optional">Set seed (optional)</h2>
<div class="sourceCode" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>fixed_seed <span class="op">=</span> <span class="dv">216</span> <span class="co">#choose seed (comment out if not needed)</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'fixed_seed'</span> <span class="kw">in</span> <span class="bu">locals</span>():</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>    keras.utils.set_random_seed(fixed_seed)</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Running program with fixed seed:"</span>,fixed_seed)</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Running program with random seed."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Running program with fixed seed: 216</code></pre>
</section>
<section id="setup-gpu" class="level2">
<h2 class="anchored" data-anchor-id="setup-gpu">Setup GPU</h2>
<p>First, follow instructions <a href="https://gist.github.com/zrruziev/b93e1292bf2ee39284f834ec7397ee9f">here</a>, or alternatively run:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> /sys/bus/pci/devices/<span class="pp">*</span><span class="kw">;</span> <span class="cf">do</span> <span class="bu">echo</span> 0 <span class="kw">|</span> <span class="fu">sudo</span> tee <span class="at">-a</span> <span class="va">$a</span>/numa_node<span class="kw">;</span> <span class="cf">done</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We do this as a workaround for <a href="https://github.com/tensorflow/tensorflow/issues/42738">this error</a>:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>gpu_devices <span class="op">=</span> tf.config.experimental.list_physical_devices(<span class="st">'GPU'</span>)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> device <span class="kw">in</span> gpu_devices:</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>    tf.config.experimental.set_memory_growth(device, <span class="va">True</span>)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tf.config.list_physical_devices(<span class="st">'GPU'</span>), tf.test.gpu_device_name())</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"TF Version:"</span>,tf.__version__)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>[PhysicalDevice(name='/physical_device:GPU:0', device_type='GPU')] /device:GPU:0
TF Version: 2.16.1


2024-04-15 22:46:24.894395: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-15 22:46:25.097387: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-15 22:46:25.097511: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-15 22:46:25.100146: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-15 22:46:25.100239: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-15 22:46:25.100292: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-15 22:46:25.201387: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-15 22:46:25.201471: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-15 22:46:25.201526: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-15 22:46:25.201574: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /device:GPU:0 with 6187 MB memory:  -&gt; device: 0, name: NVIDIA GeForce RTX 4060 Laptop GPU, pci bus id: 0000:01:00.0, compute capability: 8.9</code></pre>
</section>
<section id="define-functions-1" class="level2">
<h2 class="anchored" data-anchor-id="define-functions-1">Define Functions</h2>
<div class="sourceCode" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> violin_plotter (v,y_val,adjustment,legloc<span class="op">=</span><span class="st">"upper left"</span>):</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>    bins <span class="op">=</span> np.logspace(<span class="op">-</span><span class="dv">6</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">10</span>, base<span class="op">=</span><span class="dv">2</span>)<span class="op">*</span><span class="fl">0.85</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#v = prediction2.T[0]</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> cm.batlowS(np.digitize(v, bins))</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>    colors_actual <span class="op">=</span> cm.batlowS(np.digitize(np.unique(y_val),bins))</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>    fig, (ax1,ax2) <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>,ncols<span class="op">=</span><span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">6</span>),dpi<span class="op">=</span><span class="dv">600</span>)</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>    df.insert(<span class="dv">0</span>, <span class="st">"predicted"</span>, v <span class="op">-</span> y_val)</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>    df.insert(<span class="dv">1</span>, <span class="st">"actual"</span>, y_val)</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>    sns.violinplot(</span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>ax1,</span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>df,</span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"actual"</span>,</span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"predicted"</span>,</span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">"w"</span>,</span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>        density_norm<span class="op">=</span><span class="st">"width"</span>,</span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a>        linewidth<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a>        inner<span class="op">=</span><span class="st">"box"</span>,</span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a>        inner_kws<span class="op">=</span>{<span class="st">"box_width"</span>: <span class="dv">4</span>, <span class="st">"color"</span>: <span class="st">"0.2"</span>},</span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb111-27"><a href="#cb111-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-28"><a href="#cb111-28" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">"Actual turning rate"</span>)</span>
<span id="cb111-29"><a href="#cb111-29" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="vs">r"Prediction Difference $P_</span><span class="sc">{pred}</span><span class="vs">-P_</span><span class="sc">{true}</span><span class="vs">$"</span>)</span>
<span id="cb111-30"><a href="#cb111-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-31"><a href="#cb111-31" aria-hidden="true" tabindex="-1"></a>    std <span class="op">=</span> []</span>
<span id="cb111-32"><a href="#cb111-32" aria-hidden="true" tabindex="-1"></a>    means <span class="op">=</span> []</span>
<span id="cb111-33"><a href="#cb111-33" aria-hidden="true" tabindex="-1"></a>    overlap <span class="op">=</span> []</span>
<span id="cb111-34"><a href="#cb111-34" aria-hidden="true" tabindex="-1"></a>    std_div <span class="op">=</span> []</span>
<span id="cb111-35"><a href="#cb111-35" aria-hidden="true" tabindex="-1"></a>    accuracy <span class="op">=</span> <span class="fl">5e-3</span></span>
<span id="cb111-36"><a href="#cb111-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="st">"Prediction means and standard deviations."</span>)</span>
<span id="cb111-37"><a href="#cb111-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> val <span class="kw">in</span> np.unique(y_val):</span>
<span id="cb111-38"><a href="#cb111-38" aria-hidden="true" tabindex="-1"></a>        v_mapped <span class="op">=</span> v[np.where(y_val <span class="op">==</span> val)]</span>
<span id="cb111-39"><a href="#cb111-39" aria-hidden="true" tabindex="-1"></a>        stdev <span class="op">=</span> np.std(v_mapped)</span>
<span id="cb111-40"><a href="#cb111-40" aria-hidden="true" tabindex="-1"></a>        std.append(stdev)</span>
<span id="cb111-41"><a href="#cb111-41" aria-hidden="true" tabindex="-1"></a>        mean <span class="op">=</span> np.mean(v_mapped)</span>
<span id="cb111-42"><a href="#cb111-42" aria-hidden="true" tabindex="-1"></a>        overlap.append((val <span class="op">+</span> accuracy <span class="op">&gt;=</span> np.<span class="bu">min</span>(v_mapped)) <span class="op">&amp;</span> (val <span class="op">-</span> accuracy <span class="op">&lt;=</span> np.<span class="bu">max</span>(v_mapped)))</span>
<span id="cb111-43"><a href="#cb111-43" aria-hidden="true" tabindex="-1"></a>        within_std <span class="op">=</span> <span class="bu">abs</span>(val<span class="op">-</span>mean)<span class="op">/</span>stdev</span>
<span id="cb111-44"><a href="#cb111-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span> (<span class="ss">f"Actual value </span><span class="sc">{</span>val<span class="sc">}</span><span class="ss">: Average = </span><span class="sc">{</span>mean<span class="sc">:.5f}</span><span class="ss"> +- </span><span class="sc">{</span>stdev<span class="sc">:.5f}</span><span class="ss">; Expected value within </span><span class="sc">{</span>within_std<span class="sc">:.3f}</span><span class="ss"> stdevs of mean"</span>)</span>
<span id="cb111-45"><a href="#cb111-45" aria-hidden="true" tabindex="-1"></a>        std_div.append(within_std)</span>
<span id="cb111-46"><a href="#cb111-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-47"><a href="#cb111-47" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"With accuracy </span><span class="sc">{</span>accuracy<span class="sc">}</span><span class="ss">, overlap ratio:"</span>, np.<span class="bu">sum</span>(overlap)<span class="op">/</span><span class="bu">len</span>(overlap))</span>
<span id="cb111-48"><a href="#cb111-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"(Min, Max, Avg) STD:"</span>, np.<span class="bu">min</span>(std), np.<span class="bu">max</span>(std), np.mean(std))</span>
<span id="cb111-49"><a href="#cb111-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Pearson's correlation coeff: "</span>, pearsonr(y_val, v).statistic)</span>
<span id="cb111-50"><a href="#cb111-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-51"><a href="#cb111-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-52"><a href="#cb111-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-53"><a href="#cb111-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> val <span class="kw">in</span> np.unique(y_val):</span>
<span id="cb111-54"><a href="#cb111-54" aria-hidden="true" tabindex="-1"></a>        v_mapped <span class="op">=</span> v[np.where(y_val <span class="op">==</span> val)]</span>
<span id="cb111-55"><a href="#cb111-55" aria-hidden="true" tabindex="-1"></a>        means.append(np.mean(v_mapped))</span>
<span id="cb111-56"><a href="#cb111-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-57"><a href="#cb111-57" aria-hidden="true" tabindex="-1"></a>    ax2.errorbar(np.sort(np.unique(y_val)),np.<span class="bu">abs</span>(means<span class="op">-</span>np.sort(np.unique(y_val))),yerr<span class="op">=</span>(std),ecolor<span class="op">=</span><span class="st">'black'</span>,elinewidth<span class="op">=</span><span class="fl">0.5</span>,capsize<span class="op">=</span><span class="dv">3</span>,color<span class="op">=</span><span class="st">'purple'</span>,label<span class="op">=</span><span class="vs">r'$|\langle P_</span><span class="sc">{pred}</span><span class="vs"> \rangle -P_</span><span class="sc">{true}</span><span class="vs">|$'</span>)</span>
<span id="cb111-58"><a href="#cb111-58" aria-hidden="true" tabindex="-1"></a>    ax2.plot(np.sort(np.unique(y_val)),np.zeros(np.unique(y_val).shape[<span class="dv">0</span>]),color<span class="op">=</span><span class="st">'red'</span>,label<span class="op">=</span><span class="st">'True value line'</span>,linestyle<span class="op">=</span><span class="st">'dotted'</span>,alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb111-59"><a href="#cb111-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-60"><a href="#cb111-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-61"><a href="#cb111-61" aria-hidden="true" tabindex="-1"></a>    ax2.legend(loc<span class="op">=</span>legloc)</span>
<span id="cb111-62"><a href="#cb111-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-63"><a href="#cb111-63" aria-hidden="true" tabindex="-1"></a>    counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb111-64"><a href="#cb111-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> np.sort(np.unique(y_val)):</span>
<span id="cb111-65"><a href="#cb111-65" aria-hidden="true" tabindex="-1"></a>        ax2.text(i,adjustment,<span class="ss">f"$</span><span class="sc">{</span>std_div[counter]<span class="sc">:.3f}</span><span class="ss"> \sigma$"</span>,ha<span class="op">=</span><span class="st">"center"</span>)</span>
<span id="cb111-66"><a href="#cb111-66" aria-hidden="true" tabindex="-1"></a>        counter <span class="op">=</span> counter <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb111-67"><a href="#cb111-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-68"><a href="#cb111-68" aria-hidden="true" tabindex="-1"></a>    ax2.set_xscale(<span class="st">"log"</span>)</span>
<span id="cb111-69"><a href="#cb111-69" aria-hidden="true" tabindex="-1"></a>    ax2.get_xaxis().set_major_formatter(ticker.ScalarFormatter())</span>
<span id="cb111-70"><a href="#cb111-70" aria-hidden="true" tabindex="-1"></a>    ax2.set_xticks(np.unique(y_val))</span>
<span id="cb111-71"><a href="#cb111-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-72"><a href="#cb111-72" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">"Actual turning rate"</span>)</span>
<span id="cb111-73"><a href="#cb111-73" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">"Absolute mean prediction difference"</span>)</span>
<span id="cb111-74"><a href="#cb111-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-75"><a href="#cb111-75" aria-hidden="true" tabindex="-1"></a>    fig.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="import-and-prepare-data" class="level2">
<h2 class="anchored" data-anchor-id="import-and-prepare-data">Import and prepare data</h2>
<p>set model1 to have orientation, model2 to be monochrome, model3 to be scrambled</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co">#all alphas: [0.016,0.023,0.034,0.050,0.073,0.107,0.157,0.231,0.340,0.500]</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="co">#all densities: [0.05,0.10,0.15,0.20,0.25,0.30,0.35,0.40,0.45,0.50,0.55,0.60,0.65,0.70,0.75,0.80,0.85,0.90,0.95]</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>x1,y1,shape1 <span class="op">=</span> data_load(alphas<span class="op">=</span>[<span class="fl">0.016</span>,<span class="fl">0.023</span>,<span class="fl">0.034</span>,<span class="fl">0.050</span>,<span class="fl">0.073</span>,<span class="fl">0.1067</span>,<span class="fl">0.157</span>,<span class="fl">0.231</span>,<span class="fl">0.340</span>,<span class="fl">0.500</span>], densities<span class="op">=</span>[<span class="fl">0.25</span>],orientation<span class="op">=</span><span class="va">True</span>,scrambled<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>x2,y2,shape2 <span class="op">=</span> data_load(alphas<span class="op">=</span>[<span class="fl">0.016</span>,<span class="fl">0.023</span>,<span class="fl">0.034</span>,<span class="fl">0.050</span>,<span class="fl">0.073</span>,<span class="fl">0.1067</span>,<span class="fl">0.157</span>,<span class="fl">0.231</span>,<span class="fl">0.340</span>,<span class="fl">0.500</span>], densities<span class="op">=</span>[<span class="fl">0.25</span>],orientation<span class="op">=</span><span class="va">False</span>,scrambled<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>x3,y3,shape3 <span class="op">=</span> data_load(alphas<span class="op">=</span>[<span class="fl">0.016</span>,<span class="fl">0.023</span>,<span class="fl">0.034</span>,<span class="fl">0.050</span>,<span class="fl">0.073</span>,<span class="fl">0.1067</span>,<span class="fl">0.157</span>,<span class="fl">0.231</span>,<span class="fl">0.340</span>,<span class="fl">0.500</span>], densities<span class="op">=</span>[<span class="fl">0.25</span>],orientation<span class="op">=</span><span class="va">False</span>,scrambled<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We have N * number of unique alpha snapshots total, we split them into training set and a validation set with the ratio 80/20:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Orientation model:"</span>)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>x_train1, y_train1, x_val1, y_val1 <span class="op">=</span> split_dataset(x1,y1,last<span class="op">=</span><span class="bu">int</span>(<span class="bu">len</span>(x1)<span class="op">*</span><span class="dv">1</span>)) <span class="co">#len(x)*1 means no training, only validation!</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>x_train2, y_train2, x_val2, y_val2 <span class="op">=</span> split_dataset(x2,y2,last<span class="op">=</span><span class="bu">int</span>(<span class="bu">len</span>(x1)<span class="op">*</span><span class="dv">1</span>)) <span class="co">#len(x)*1 means no training, only validation!</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>x_train3, y_train3, x_val3, y_val3 <span class="op">=</span> split_dataset(x3,y3,last<span class="op">=</span><span class="bu">int</span>(<span class="bu">len</span>(x1)<span class="op">*</span><span class="dv">1</span>)) <span class="co">#len(x)*1 means no training, only validation!</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Orientation model:
Number of unique alpha:  10
Shape of x:  (10000, 128, 128, 1)
Shape of y:  (10000,)
Size of training data:  0
Size of validation data:  10000
Number of unique alpha:  10
Shape of x:  (10000, 128, 128, 1)
Shape of y:  (10000,)
Size of training data:  0
Size of validation data:  10000
Number of unique alpha:  10
Shape of x:  (10000, 128, 128, 1)
Shape of y:  (10000,)
Size of training data:  0
Size of validation data:  10000</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2,ax3) <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>,ncols<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>ax1.matshow(x_val1[<span class="dv">500</span>],cmap<span class="op">=</span>plt.get_cmap(name<span class="op">=</span><span class="st">"gnuplot"</span>,lut<span class="op">=</span><span class="dv">5</span>))</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>ax2.matshow(x_val2[<span class="dv">500</span>],cmap<span class="op">=</span>plt.get_cmap(name<span class="op">=</span><span class="st">"gnuplot"</span>,lut<span class="op">=</span><span class="dv">5</span>))</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>ax3.matshow(x_val3[<span class="dv">500</span>],cmap<span class="op">=</span>plt.get_cmap(name<span class="op">=</span><span class="st">"gnuplot"</span>,lut<span class="op">=</span><span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>&lt;matplotlib.image.AxesImage at 0x7f253eff1030&gt;</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_multiple_validation_files/cp_multiple_validation_14_1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="predict-multiple-models" class="level2">
<h2 class="anchored" data-anchor-id="predict-multiple-models">Predict multiple models</h2>
<div class="sourceCode" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>models_one <span class="op">=</span> [<span class="st">'orientation0216'</span>,<span class="st">'orientation0226'</span>,<span class="st">'orientation0236'</span>,<span class="st">'orientation0246'</span>,<span class="st">'orientation0256'</span>,<span class="st">'orientation0266'</span>,<span class="st">'orientation0276'</span>,<span class="st">'orientation0286'</span>,<span class="st">'orientation0296'</span>,<span class="st">'orientation0306'</span>] <span class="co">#array of model names</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>models_two <span class="op">=</span> [<span class="st">'monochrome0216'</span>,<span class="st">'monochrome0226'</span>,<span class="st">'monochrome0236'</span>,<span class="st">'monochrome0246'</span>,<span class="st">'monochrome0256'</span>,<span class="st">'monochrome0266'</span>,<span class="st">'monochrome0276'</span>,<span class="st">'monochrome0286'</span>,<span class="st">'monochrome0296'</span>,<span class="st">'monochrome0306'</span>] <span class="co"># array of model names</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>models_three <span class="op">=</span> [<span class="st">'scrambled0216'</span>,<span class="st">'scrambled0226'</span>,<span class="st">'scrambled0236'</span>,<span class="st">'scrambled0246'</span>,<span class="st">'scrambled0256'</span>,<span class="st">'scrambled0266'</span>,<span class="st">'scrambled0276'</span>,<span class="st">'scrambled0286'</span>,<span class="st">'scrambled0296'</span>,<span class="st">'scrambled0306'</span>] <span class="co"># array of model names</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>one_pred_of_one, one_actuals_of_one <span class="op">=</span> predict_multi_by_name(models_one,x_val1,y_val1)</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>one_pred_of_two, one_actuals_of_two <span class="op">=</span> predict_multi_by_name(models_one,x_val2,y_val2)</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>one_pred_of_three, one_actuals_of_three <span class="op">=</span> predict_multi_by_name(models_one,x_val3,y_val3)</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>two_pred_of_two, two_actuals_of_two <span class="op">=</span> predict_multi_by_name(models_two,x_val2,y_val2)</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>two_pred_of_one, two_actuals_of_one <span class="op">=</span> predict_multi_by_name(models_two,x_val1,y_val1)</span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>two_pred_of_three, two_actuals_of_three <span class="op">=</span> predict_multi_by_name(models_two,x_val3,y_val3)</span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>three_pred_of_three, three_actuals_of_three <span class="op">=</span> predict_multi_by_name(models_three,x_val3,y_val3)</span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a>three_pred_of_one, three_actuals_of_one <span class="op">=</span> predict_multi_by_name(models_three,x_val1,y_val1)</span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a>three_pred_of_two, three_actuals_of_two <span class="op">=</span> predict_multi_by_name(models_three,x_val2,y_val2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>2024-04-15 22:46:33.673278: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-15 22:46:33.673415: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-15 22:46:33.673470: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-15 22:46:33.673546: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-15 22:46:33.673596: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2024-04-15 22:46:33.673640: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 6187 MB memory:  -&gt; device: 0, name: NVIDIA GeForce RTX 4060 Laptop GPU, pci bus id: 0000:01:00.0, compute capability: 8.9
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
I0000 00:00:1713217594.529131   80228 service.cc:145] XLA service 0x7f223c004550 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
I0000 00:00:1713217594.529189   80228 service.cc:153]   StreamExecutor device (0): NVIDIA GeForce RTX 4060 Laptop GPU, Compute Capability 8.9
2024-04-15 22:46:34.535575: I tensorflow/compiler/mlir/tensorflow/utils/dump_mlir_util.cc:268] disabling MLIR crash reproducer, set env var `MLIR_CRASH_REPRODUCER_DIRECTORY` to enable.
2024-04-15 22:46:34.563498: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8907
I0000 00:00:1713217595.037178   80228 device_compiler.h:188] Compiled cluster using XLA!  This line is logged at most once for the lifetime of the process.</code></pre>
</section>
<section id="combined-plots" class="level2">
<h2 class="anchored" data-anchor-id="combined-plots">Combined plots</h2>
<div class="sourceCode" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co">#predictions on own kind</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="co">#means1,std1,means2,std2,means3,std3=cross_mean_err_calculator(one_pred_of_one,one_actuals_of_one,two_pred_of_two,two_actuals_of_two,three_pred_of_three,three_actuals_of_three,three_cases=True)</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>fig, (ax1,ax2) <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>,ncols<span class="op">=</span><span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">11</span>,<span class="dv">6</span>),dpi<span class="op">=</span><span class="dv">600</span>)</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="co">#NOTE: I've commented out the previous method of plotting due to its inelegance, but I have kept it for posterity as a way of plotting error bands without seaborn.</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a><span class="co">#ONE ON ONE</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.errorbar(np.sort(np.unique(orientation_actuals_of_orientation)),np.abs(means1-np.sort(np.unique(orientation_actuals_of_orientation))),yerr=(std1),ecolor='blue',elinewidth=0.5,capsize=3,color='blue',label="Trained Orientation Predicting Orientation")</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.plot(np.sort(np.unique(one_actuals_of_one)),np.abs(means1-np.sort(np.unique(one_actuals_of_one))),'b-',label="Trained Orientation Predicting Orientation")</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.fill_between(np.sort(np.unique(one_actuals_of_one)),np.abs(means1-np.sort(np.unique(one_actuals_of_one)))-std1,np.abs(means1-np.sort(np.unique(one_actuals_of_one)))+std1,color='b',alpha=0.25)</span></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a><span class="co">#TWO ON TWO</span></span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.errorbar(np.sort(np.unique(monochrome_actuals_of_monochrome)),np.abs(means2-np.sort(np.unique(monochrome_actuals_of_monochrome))),yerr=(std2),ecolor='red',elinewidth=0.5,capsize=3,color='red',label="Trained Monochrome Predicting Monochrome")</span></span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.plot(np.sort(np.unique(two_actuals_of_two)),np.abs(means2-np.sort(np.unique(two_actuals_of_two))),'r-',label="Trained Monochrome Predicting Monochrome")</span></span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.fill_between(np.sort(np.unique(two_actuals_of_two)),np.abs(means2-np.sort(np.unique(two_actuals_of_two)))-std2,np.abs(means2-np.sort(np.unique(two_actuals_of_two)))+std2,color='r',alpha=0.25)</span></span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a><span class="co">#THREE ON THREE</span></span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.plot(np.sort(np.unique(three_actuals_of_three)),np.abs(means3-np.sort(np.unique(three_actuals_of_three))),'g-',label="Trained Scrambled Predicting Scrambled")</span></span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.fill_between(np.sort(np.unique(three_actuals_of_three)),np.abs(means3-np.sort(np.unique(three_actuals_of_three)))-std3,np.abs(means3-np.sort(np.unique(three_actuals_of_three)))+std3,color='g',alpha=0.25)</span></span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-22"><a href="#cb119-22" aria-hidden="true" tabindex="-1"></a><span class="co">#ZERO LINE, LEGEND, AX1 PLOT CONFIG</span></span>
<span id="cb119-23"><a href="#cb119-23" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.plot(np.sort(np.unique(one_actuals_of_one)),np.zeros(np.unique(one_actuals_of_one).shape[0]),color='black',label='True value line',linestyle='dotted',alpha=0.5)</span></span>
<span id="cb119-24"><a href="#cb119-24" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.legend(loc='upper left')</span></span>
<span id="cb119-25"><a href="#cb119-25" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_xscale("log")</span></span>
<span id="cb119-26"><a href="#cb119-26" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.get_xaxis().set_major_formatter(ticker.ScalarFormatter())</span></span>
<span id="cb119-27"><a href="#cb119-27" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_xticks(np.unique(y_val1))</span></span>
<span id="cb119-28"><a href="#cb119-28" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_xlabel("Actual turning rate")</span></span>
<span id="cb119-29"><a href="#cb119-29" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_ylabel("Absolute mean prediction difference")</span></span>
<span id="cb119-30"><a href="#cb119-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-31"><a href="#cb119-31" aria-hidden="true" tabindex="-1"></a>df_one <span class="op">=</span> pd.DataFrame()</span>
<span id="cb119-32"><a href="#cb119-32" aria-hidden="true" tabindex="-1"></a>df_two <span class="op">=</span> pd.DataFrame()</span>
<span id="cb119-33"><a href="#cb119-33" aria-hidden="true" tabindex="-1"></a>df_three <span class="op">=</span> pd.DataFrame()</span>
<span id="cb119-34"><a href="#cb119-34" aria-hidden="true" tabindex="-1"></a>df_one.insert(<span class="dv">0</span>,<span class="st">"predicted"</span>,np.<span class="bu">abs</span>(one_pred_of_one<span class="op">-</span>one_actuals_of_one))</span>
<span id="cb119-35"><a href="#cb119-35" aria-hidden="true" tabindex="-1"></a>df_one.insert(<span class="dv">1</span>,<span class="st">"actuals"</span>,one_actuals_of_one)</span>
<span id="cb119-36"><a href="#cb119-36" aria-hidden="true" tabindex="-1"></a>df_two.insert(<span class="dv">0</span>,<span class="st">"predicted"</span>,np.<span class="bu">abs</span>(two_pred_of_two<span class="op">-</span>two_actuals_of_two))</span>
<span id="cb119-37"><a href="#cb119-37" aria-hidden="true" tabindex="-1"></a>df_two.insert(<span class="dv">1</span>,<span class="st">"actuals"</span>,np.<span class="bu">abs</span>(two_actuals_of_two))</span>
<span id="cb119-38"><a href="#cb119-38" aria-hidden="true" tabindex="-1"></a>df_three.insert(<span class="dv">0</span>,<span class="st">"predicted"</span>,np.<span class="bu">abs</span>(three_pred_of_three<span class="op">-</span>three_actuals_of_three))</span>
<span id="cb119-39"><a href="#cb119-39" aria-hidden="true" tabindex="-1"></a>df_three.insert(<span class="dv">1</span>,<span class="st">"actuals"</span>,np.<span class="bu">abs</span>(three_actuals_of_three))</span>
<span id="cb119-40"><a href="#cb119-40" aria-hidden="true" tabindex="-1"></a>df_one[<span class="st">'Data Type'</span>]<span class="op">=</span><span class="st">'Orientation'</span></span>
<span id="cb119-41"><a href="#cb119-41" aria-hidden="true" tabindex="-1"></a>df_two[<span class="st">'Data Type'</span>]<span class="op">=</span><span class="st">'Monochrome'</span></span>
<span id="cb119-42"><a href="#cb119-42" aria-hidden="true" tabindex="-1"></a>df_three[<span class="st">'Data Type'</span>]<span class="op">=</span><span class="st">'Scrambled'</span></span>
<span id="cb119-43"><a href="#cb119-43" aria-hidden="true" tabindex="-1"></a>cdf <span class="op">=</span> pd.concat([df_one,df_two,df_three])</span>
<span id="cb119-44"><a href="#cb119-44" aria-hidden="true" tabindex="-1"></a><span class="co">#print(cdf.head())</span></span>
<span id="cb119-45"><a href="#cb119-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-46"><a href="#cb119-46" aria-hidden="true" tabindex="-1"></a>sns.lineplot(ax<span class="op">=</span>ax1,</span>
<span id="cb119-47"><a href="#cb119-47" aria-hidden="true" tabindex="-1"></a>             x<span class="op">=</span><span class="st">"actuals"</span>,</span>
<span id="cb119-48"><a href="#cb119-48" aria-hidden="true" tabindex="-1"></a>             y<span class="op">=</span><span class="st">"predicted"</span>,</span>
<span id="cb119-49"><a href="#cb119-49" aria-hidden="true" tabindex="-1"></a>             hue<span class="op">=</span><span class="st">"Data Type"</span>,</span>
<span id="cb119-50"><a href="#cb119-50" aria-hidden="true" tabindex="-1"></a>             data<span class="op">=</span>cdf,</span>
<span id="cb119-51"><a href="#cb119-51" aria-hidden="true" tabindex="-1"></a>             errorbar<span class="op">=</span><span class="st">"sd"</span>,</span>
<span id="cb119-52"><a href="#cb119-52" aria-hidden="true" tabindex="-1"></a>             palette<span class="op">=</span>{<span class="st">"Orientation"</span>: <span class="st">"blue"</span>, <span class="st">"Monochrome"</span>: <span class="st">"red"</span>, <span class="st">"Scrambled"</span>: <span class="st">"green"</span>})</span>
<span id="cb119-53"><a href="#cb119-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-54"><a href="#cb119-54" aria-hidden="true" tabindex="-1"></a>sns.boxplot(ax<span class="op">=</span>ax2,</span>
<span id="cb119-55"><a href="#cb119-55" aria-hidden="true" tabindex="-1"></a>            data<span class="op">=</span>cdf,</span>
<span id="cb119-56"><a href="#cb119-56" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="st">"actuals"</span>,</span>
<span id="cb119-57"><a href="#cb119-57" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span><span class="st">"predicted"</span>,</span>
<span id="cb119-58"><a href="#cb119-58" aria-hidden="true" tabindex="-1"></a>            hue<span class="op">=</span><span class="st">"Data Type"</span>,</span>
<span id="cb119-59"><a href="#cb119-59" aria-hidden="true" tabindex="-1"></a>            fill<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb119-60"><a href="#cb119-60" aria-hidden="true" tabindex="-1"></a>            gap<span class="op">=</span><span class="fl">.4</span>,</span>
<span id="cb119-61"><a href="#cb119-61" aria-hidden="true" tabindex="-1"></a>            whis<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">100</span>),</span>
<span id="cb119-62"><a href="#cb119-62" aria-hidden="true" tabindex="-1"></a>            width<span class="op">=</span><span class="fl">.5</span>,</span>
<span id="cb119-63"><a href="#cb119-63" aria-hidden="true" tabindex="-1"></a>            palette<span class="op">=</span>{<span class="st">"Orientation"</span>: <span class="st">"blue"</span>, <span class="st">"Monochrome"</span>: <span class="st">"red"</span>, <span class="st">"Scrambled"</span>: <span class="st">"green"</span>})</span>
<span id="cb119-64"><a href="#cb119-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-65"><a href="#cb119-65" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">"Actual turning rate"</span>,fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb119-66"><a href="#cb119-66" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">"Actual turning rate"</span>,fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb119-67"><a href="#cb119-67" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">"Absolute mean prediction difference"</span>,fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb119-68"><a href="#cb119-68" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">"Absolute mean prediction difference"</span>,fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb119-69"><a href="#cb119-69" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"IQR Comparison of Self-Prediction"</span>,fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb119-70"><a href="#cb119-70" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"STD Comparison of Self-Prediction"</span>,fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb119-71"><a href="#cb119-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-72"><a href="#cb119-72" aria-hidden="true" tabindex="-1"></a>ax1.set_xscale(<span class="st">"log"</span>)</span>
<span id="cb119-73"><a href="#cb119-73" aria-hidden="true" tabindex="-1"></a>ax1.get_xaxis().set_major_formatter(ticker.ScalarFormatter())</span>
<span id="cb119-74"><a href="#cb119-74" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks(np.unique(y_val1))</span>
<span id="cb119-75"><a href="#cb119-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-76"><a href="#cb119-76" aria-hidden="true" tabindex="-1"></a><span class="co">#handles,labels=ax2.get_legend_handles_labels()</span></span>
<span id="cb119-77"><a href="#cb119-77" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.legend(handles=handles[1:],labels=labels[1:]) #this should fix hue title appearing in rightmost figure legend</span></span>
<span id="cb119-78"><a href="#cb119-78" aria-hidden="true" tabindex="-1"></a>ax1.legend(loc<span class="op">=</span><span class="st">"upper left"</span>,fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb119-79"><a href="#cb119-79" aria-hidden="true" tabindex="-1"></a>ax2.legend(fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb119-80"><a href="#cb119-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-81"><a href="#cb119-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-82"><a href="#cb119-82" aria-hidden="true" tabindex="-1"></a><span class="co">#predictions on other kind</span></span>
<span id="cb119-83"><a href="#cb119-83" aria-hidden="true" tabindex="-1"></a><span class="co">#means1,std1,means2,std2,means3,std3=cross_mean_err_calculator(one_pred_of_two,one_actuals_of_two,two_pred_of_one,two_actuals_of_one,three_cases=False)</span></span>
<span id="cb119-84"><a href="#cb119-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-85"><a href="#cb119-85" aria-hidden="true" tabindex="-1"></a><span class="co">#ONE ON TWO</span></span>
<span id="cb119-86"><a href="#cb119-86" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.errorbar(np.sort(np.unique(orientation_actuals_of_monochrome)),np.abs(means1-np.sort(np.unique(orientation_actuals_of_monochrome))),yerr=(std1),ecolor='blue',elinewidth=0.5,capsize=3,color='blue',label="Trained Orientation Predicting Monochrome")</span></span>
<span id="cb119-87"><a href="#cb119-87" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.plot(np.sort(np.unique(one_actuals_of_two)),np.abs(means1-np.sort(np.unique(one_actuals_of_two))),'b-',label="Trained Orientation Predicting Monochrome")</span></span>
<span id="cb119-88"><a href="#cb119-88" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.fill_between(np.sort(np.unique(one_actuals_of_two)),np.abs(means1-np.sort(np.unique(one_actuals_of_two)))-std1,np.abs(means1-np.sort(np.unique(one_actuals_of_two)))+std1,color='b',alpha=0.25)</span></span>
<span id="cb119-89"><a href="#cb119-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-90"><a href="#cb119-90" aria-hidden="true" tabindex="-1"></a><span class="co">#TWO ON ONE</span></span>
<span id="cb119-91"><a href="#cb119-91" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.errorbar(np.sort(np.unique(monochrome_actuals_of_orientation)),np.abs(means2-np.sort(np.unique(monochrome_actuals_of_orientation))),yerr=(std2),ecolor='red',elinewidth=0.5,capsize=3,color='red',label="Trained Monochrome Predicting Orientation")</span></span>
<span id="cb119-92"><a href="#cb119-92" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.plot(np.sort(np.unique(two_actuals_of_one)),np.abs(means2-np.sort(np.unique(two_actuals_of_one))),'r-',label="Trained Monochrome Predicting Orientation")</span></span>
<span id="cb119-93"><a href="#cb119-93" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.fill_between(np.sort(np.unique(two_actuals_of_one)),np.abs(means2-np.sort(np.unique(two_actuals_of_one)))-std2,np.abs(means2-np.sort(np.unique(two_actuals_of_one)))+std2,color='r',alpha=0.25)</span></span>
<span id="cb119-94"><a href="#cb119-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-95"><a href="#cb119-95" aria-hidden="true" tabindex="-1"></a><span class="co">#ZERO LINE, LEGEND, AX2 PLOT CONFIG</span></span>
<span id="cb119-96"><a href="#cb119-96" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.plot(np.sort(np.unique(one_actuals_of_two)),np.zeros(np.unique(one_actuals_of_two).shape[0]),color='black',label='True value line',linestyle='dotted',alpha=0.5)</span></span>
<span id="cb119-97"><a href="#cb119-97" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.legend(loc='upper left')</span></span>
<span id="cb119-98"><a href="#cb119-98" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.set_xscale("log")</span></span>
<span id="cb119-99"><a href="#cb119-99" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.get_xaxis().set_major_formatter(ticker.ScalarFormatter())</span></span>
<span id="cb119-100"><a href="#cb119-100" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.set_xticks(np.unique(y_val1))</span></span>
<span id="cb119-101"><a href="#cb119-101" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.set_xlabel("Actual turning rate")</span></span>
<span id="cb119-102"><a href="#cb119-102" aria-hidden="true" tabindex="-1"></a><span class="co">#ax2.set_ylabel("Absolute mean prediction difference")</span></span>
<span id="cb119-103"><a href="#cb119-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-104"><a href="#cb119-104" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_multiple_validation_files/cp_multiple_validation_39_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
<div class="sourceCode" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>df12<span class="op">=</span>pd.DataFrame()</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>df21<span class="op">=</span>pd.DataFrame()</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>df13<span class="op">=</span>pd.DataFrame()</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>df31<span class="op">=</span>pd.DataFrame()</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>df23<span class="op">=</span>pd.DataFrame()</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>df32<span class="op">=</span>pd.DataFrame()</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>df12.insert(<span class="dv">0</span>,<span class="st">"predicted"</span>,np.<span class="bu">abs</span>(one_pred_of_two<span class="op">-</span>one_actuals_of_two))</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>df12.insert(<span class="dv">1</span>,<span class="st">"actuals"</span>,one_actuals_of_two)</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>df21.insert(<span class="dv">0</span>,<span class="st">"predicted"</span>,np.<span class="bu">abs</span>(two_pred_of_one<span class="op">-</span>two_actuals_of_one))</span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>df21.insert(<span class="dv">1</span>,<span class="st">"actuals"</span>,two_actuals_of_one)</span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>df13.insert(<span class="dv">0</span>,<span class="st">"predicted"</span>,np.<span class="bu">abs</span>(one_pred_of_three<span class="op">-</span>one_actuals_of_three))</span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>df13.insert(<span class="dv">1</span>,<span class="st">"actuals"</span>,one_actuals_of_three)</span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>df31.insert(<span class="dv">0</span>,<span class="st">"predicted"</span>,np.<span class="bu">abs</span>(three_pred_of_one<span class="op">-</span>three_actuals_of_one))</span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>df31.insert(<span class="dv">1</span>,<span class="st">"actuals"</span>,three_actuals_of_one)</span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>df23.insert(<span class="dv">0</span>,<span class="st">"predicted"</span>,np.<span class="bu">abs</span>(two_pred_of_three<span class="op">-</span>two_actuals_of_three))</span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>df23.insert(<span class="dv">1</span>,<span class="st">"actuals"</span>,two_actuals_of_three)</span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a>df32.insert(<span class="dv">0</span>,<span class="st">"predicted"</span>,np.<span class="bu">abs</span>(three_pred_of_two<span class="op">-</span>three_actuals_of_two))</span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a>df32.insert(<span class="dv">1</span>,<span class="st">"actuals"</span>,three_actuals_of_two)</span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a>fig,ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">3</span>,ncols<span class="op">=</span><span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">16</span>),dpi<span class="op">=</span><span class="dv">600</span>)</span>
<span id="cb120-21"><a href="#cb120-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-22"><a href="#cb120-22" aria-hidden="true" tabindex="-1"></a><span class="co">#PREDICTING ONE</span></span>
<span id="cb120-23"><a href="#cb120-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-24"><a href="#cb120-24" aria-hidden="true" tabindex="-1"></a>df21[<span class="st">'Data Type'</span>]<span class="op">=</span><span class="st">'Monochrome'</span></span>
<span id="cb120-25"><a href="#cb120-25" aria-hidden="true" tabindex="-1"></a>df31[<span class="st">'Data Type'</span>]<span class="op">=</span><span class="st">'Scrambled'</span></span>
<span id="cb120-26"><a href="#cb120-26" aria-hidden="true" tabindex="-1"></a>cdf <span class="op">=</span> pd.concat([df_one,df21,df31])</span>
<span id="cb120-27"><a href="#cb120-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-28"><a href="#cb120-28" aria-hidden="true" tabindex="-1"></a>sns.lineplot(ax<span class="op">=</span>ax[<span class="dv">0</span>][<span class="dv">0</span>],</span>
<span id="cb120-29"><a href="#cb120-29" aria-hidden="true" tabindex="-1"></a>             x<span class="op">=</span><span class="st">"actuals"</span>,</span>
<span id="cb120-30"><a href="#cb120-30" aria-hidden="true" tabindex="-1"></a>             y<span class="op">=</span><span class="st">"predicted"</span>,</span>
<span id="cb120-31"><a href="#cb120-31" aria-hidden="true" tabindex="-1"></a>             hue<span class="op">=</span><span class="st">"Data Type"</span>,</span>
<span id="cb120-32"><a href="#cb120-32" aria-hidden="true" tabindex="-1"></a>             data<span class="op">=</span>cdf,</span>
<span id="cb120-33"><a href="#cb120-33" aria-hidden="true" tabindex="-1"></a>             errorbar<span class="op">=</span><span class="st">"sd"</span>,</span>
<span id="cb120-34"><a href="#cb120-34" aria-hidden="true" tabindex="-1"></a>             palette<span class="op">=</span>{<span class="st">"Orientation"</span>: <span class="st">"blue"</span>, <span class="st">"Monochrome"</span>: <span class="st">"red"</span>, <span class="st">"Scrambled"</span>: <span class="st">"green"</span>})</span>
<span id="cb120-35"><a href="#cb120-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-36"><a href="#cb120-36" aria-hidden="true" tabindex="-1"></a>sns.boxplot(ax<span class="op">=</span>ax[<span class="dv">0</span>][<span class="dv">1</span>],</span>
<span id="cb120-37"><a href="#cb120-37" aria-hidden="true" tabindex="-1"></a>            data<span class="op">=</span>cdf,</span>
<span id="cb120-38"><a href="#cb120-38" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="st">"actuals"</span>,</span>
<span id="cb120-39"><a href="#cb120-39" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span><span class="st">"predicted"</span>,</span>
<span id="cb120-40"><a href="#cb120-40" aria-hidden="true" tabindex="-1"></a>            hue<span class="op">=</span><span class="st">"Data Type"</span>,</span>
<span id="cb120-41"><a href="#cb120-41" aria-hidden="true" tabindex="-1"></a>            fill<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb120-42"><a href="#cb120-42" aria-hidden="true" tabindex="-1"></a>            gap<span class="op">=</span><span class="fl">.4</span>,</span>
<span id="cb120-43"><a href="#cb120-43" aria-hidden="true" tabindex="-1"></a>            whis<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">100</span>),</span>
<span id="cb120-44"><a href="#cb120-44" aria-hidden="true" tabindex="-1"></a>            width<span class="op">=</span><span class="fl">.5</span>,</span>
<span id="cb120-45"><a href="#cb120-45" aria-hidden="true" tabindex="-1"></a>            palette<span class="op">=</span>{<span class="st">"Orientation"</span>: <span class="st">"blue"</span>, <span class="st">"Monochrome"</span>: <span class="st">"red"</span>, <span class="st">"Scrambled"</span>: <span class="st">"green"</span>})</span>
<span id="cb120-46"><a href="#cb120-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-47"><a href="#cb120-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-48"><a href="#cb120-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-49"><a href="#cb120-49" aria-hidden="true" tabindex="-1"></a><span class="co">#PREDICTING TWO</span></span>
<span id="cb120-50"><a href="#cb120-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-51"><a href="#cb120-51" aria-hidden="true" tabindex="-1"></a>df12[<span class="st">'Data Type'</span>]<span class="op">=</span><span class="st">'Orientation'</span></span>
<span id="cb120-52"><a href="#cb120-52" aria-hidden="true" tabindex="-1"></a>df32[<span class="st">'Data Type'</span>]<span class="op">=</span><span class="st">'Scrambled'</span></span>
<span id="cb120-53"><a href="#cb120-53" aria-hidden="true" tabindex="-1"></a>cdf <span class="op">=</span> pd.concat([df12,df_two,df32])</span>
<span id="cb120-54"><a href="#cb120-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-55"><a href="#cb120-55" aria-hidden="true" tabindex="-1"></a>sns.lineplot(ax<span class="op">=</span>ax[<span class="dv">1</span>][<span class="dv">0</span>],</span>
<span id="cb120-56"><a href="#cb120-56" aria-hidden="true" tabindex="-1"></a>             x<span class="op">=</span><span class="st">"actuals"</span>,</span>
<span id="cb120-57"><a href="#cb120-57" aria-hidden="true" tabindex="-1"></a>             y<span class="op">=</span><span class="st">"predicted"</span>,</span>
<span id="cb120-58"><a href="#cb120-58" aria-hidden="true" tabindex="-1"></a>             hue<span class="op">=</span><span class="st">"Data Type"</span>,</span>
<span id="cb120-59"><a href="#cb120-59" aria-hidden="true" tabindex="-1"></a>             data<span class="op">=</span>cdf,</span>
<span id="cb120-60"><a href="#cb120-60" aria-hidden="true" tabindex="-1"></a>             errorbar<span class="op">=</span><span class="st">"sd"</span>,</span>
<span id="cb120-61"><a href="#cb120-61" aria-hidden="true" tabindex="-1"></a>             palette<span class="op">=</span>{<span class="st">"Orientation"</span>: <span class="st">"blue"</span>, <span class="st">"Monochrome"</span>: <span class="st">"red"</span>, <span class="st">"Scrambled"</span>: <span class="st">"green"</span>})</span>
<span id="cb120-62"><a href="#cb120-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-63"><a href="#cb120-63" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">0</span>].legend(loc<span class="op">=</span><span class="st">'upper left'</span>,fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb120-64"><a href="#cb120-64" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>][<span class="dv">1</span>].legend(loc<span class="op">=</span><span class="st">'upper right'</span>,fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb120-65"><a href="#cb120-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-66"><a href="#cb120-66" aria-hidden="true" tabindex="-1"></a>sns.boxplot(ax<span class="op">=</span>ax[<span class="dv">1</span>][<span class="dv">1</span>],</span>
<span id="cb120-67"><a href="#cb120-67" aria-hidden="true" tabindex="-1"></a>            data<span class="op">=</span>cdf,</span>
<span id="cb120-68"><a href="#cb120-68" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="st">"actuals"</span>,</span>
<span id="cb120-69"><a href="#cb120-69" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span><span class="st">"predicted"</span>,</span>
<span id="cb120-70"><a href="#cb120-70" aria-hidden="true" tabindex="-1"></a>            hue<span class="op">=</span><span class="st">"Data Type"</span>,</span>
<span id="cb120-71"><a href="#cb120-71" aria-hidden="true" tabindex="-1"></a>            fill<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb120-72"><a href="#cb120-72" aria-hidden="true" tabindex="-1"></a>            gap<span class="op">=</span><span class="fl">.4</span>,</span>
<span id="cb120-73"><a href="#cb120-73" aria-hidden="true" tabindex="-1"></a>            whis<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">100</span>),</span>
<span id="cb120-74"><a href="#cb120-74" aria-hidden="true" tabindex="-1"></a>            width<span class="op">=</span><span class="fl">.5</span>,</span>
<span id="cb120-75"><a href="#cb120-75" aria-hidden="true" tabindex="-1"></a>            palette<span class="op">=</span>{<span class="st">"Orientation"</span>: <span class="st">"blue"</span>, <span class="st">"Monochrome"</span>: <span class="st">"red"</span>, <span class="st">"Scrambled"</span>: <span class="st">"green"</span>})</span>
<span id="cb120-76"><a href="#cb120-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-77"><a href="#cb120-77" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">0</span>].legend(loc<span class="op">=</span><span class="st">'upper left'</span>,fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb120-78"><a href="#cb120-78" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>][<span class="dv">1</span>].legend(loc<span class="op">=</span><span class="st">'upper left'</span>,fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb120-79"><a href="#cb120-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-80"><a href="#cb120-80" aria-hidden="true" tabindex="-1"></a><span class="co">#PREDICTING THREE</span></span>
<span id="cb120-81"><a href="#cb120-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-82"><a href="#cb120-82" aria-hidden="true" tabindex="-1"></a>df13[<span class="st">'Data Type'</span>]<span class="op">=</span><span class="st">'Orientation'</span></span>
<span id="cb120-83"><a href="#cb120-83" aria-hidden="true" tabindex="-1"></a>df23[<span class="st">'Data Type'</span>]<span class="op">=</span><span class="st">'Monochrome'</span></span>
<span id="cb120-84"><a href="#cb120-84" aria-hidden="true" tabindex="-1"></a>cdf <span class="op">=</span> pd.concat([df13,df23,df_three])</span>
<span id="cb120-85"><a href="#cb120-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-86"><a href="#cb120-86" aria-hidden="true" tabindex="-1"></a>sns.lineplot(ax<span class="op">=</span>ax[<span class="dv">2</span>][<span class="dv">0</span>],</span>
<span id="cb120-87"><a href="#cb120-87" aria-hidden="true" tabindex="-1"></a>             x<span class="op">=</span><span class="st">"actuals"</span>,</span>
<span id="cb120-88"><a href="#cb120-88" aria-hidden="true" tabindex="-1"></a>             y<span class="op">=</span><span class="st">"predicted"</span>,</span>
<span id="cb120-89"><a href="#cb120-89" aria-hidden="true" tabindex="-1"></a>             hue<span class="op">=</span><span class="st">"Data Type"</span>,</span>
<span id="cb120-90"><a href="#cb120-90" aria-hidden="true" tabindex="-1"></a>             data<span class="op">=</span>cdf,</span>
<span id="cb120-91"><a href="#cb120-91" aria-hidden="true" tabindex="-1"></a>             errorbar<span class="op">=</span><span class="st">"sd"</span>,</span>
<span id="cb120-92"><a href="#cb120-92" aria-hidden="true" tabindex="-1"></a>             palette<span class="op">=</span>{<span class="st">"Orientation"</span>: <span class="st">"blue"</span>, <span class="st">"Monochrome"</span>: <span class="st">"red"</span>, <span class="st">"Scrambled"</span>: <span class="st">"green"</span>})</span>
<span id="cb120-93"><a href="#cb120-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-94"><a href="#cb120-94" aria-hidden="true" tabindex="-1"></a>sns.boxplot(ax<span class="op">=</span>ax[<span class="dv">2</span>][<span class="dv">1</span>],</span>
<span id="cb120-95"><a href="#cb120-95" aria-hidden="true" tabindex="-1"></a>            data<span class="op">=</span>cdf,</span>
<span id="cb120-96"><a href="#cb120-96" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="st">"actuals"</span>,</span>
<span id="cb120-97"><a href="#cb120-97" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span><span class="st">"predicted"</span>,</span>
<span id="cb120-98"><a href="#cb120-98" aria-hidden="true" tabindex="-1"></a>            hue<span class="op">=</span><span class="st">"Data Type"</span>,</span>
<span id="cb120-99"><a href="#cb120-99" aria-hidden="true" tabindex="-1"></a>            fill<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb120-100"><a href="#cb120-100" aria-hidden="true" tabindex="-1"></a>            gap<span class="op">=</span><span class="fl">.4</span>,</span>
<span id="cb120-101"><a href="#cb120-101" aria-hidden="true" tabindex="-1"></a>            whis<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">100</span>),</span>
<span id="cb120-102"><a href="#cb120-102" aria-hidden="true" tabindex="-1"></a>            width<span class="op">=</span><span class="fl">.5</span>,</span>
<span id="cb120-103"><a href="#cb120-103" aria-hidden="true" tabindex="-1"></a>            palette<span class="op">=</span>{<span class="st">"Orientation"</span>: <span class="st">"blue"</span>, <span class="st">"Monochrome"</span>: <span class="st">"red"</span>, <span class="st">"Scrambled"</span>: <span class="st">"green"</span>})</span>
<span id="cb120-104"><a href="#cb120-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-105"><a href="#cb120-105" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>][<span class="dv">1</span>].legend(fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb120-106"><a href="#cb120-106" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>][<span class="dv">0</span>].legend(loc<span class="op">=</span><span class="st">'upper left'</span>,fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb120-107"><a href="#cb120-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-108"><a href="#cb120-108" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,examiner <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="st">"STD"</span>,<span class="st">"IQR"</span>]):</span>
<span id="cb120-109"><a href="#cb120-109" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j,examined <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="st">"Orientation"</span>,<span class="st">"Monochrome"</span>,<span class="st">"Scrambled"</span>]):</span>
<span id="cb120-110"><a href="#cb120-110" aria-hidden="true" tabindex="-1"></a>        ax[j][i].set_xlabel(<span class="st">"Actual turning rate"</span>,fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb120-111"><a href="#cb120-111" aria-hidden="true" tabindex="-1"></a>        ax[j][i].set_ylabel(<span class="st">"Absolute mean prediction difference"</span>,fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb120-112"><a href="#cb120-112" aria-hidden="true" tabindex="-1"></a>        ax[j][i].set_title(<span class="ss">f"</span><span class="sc">{</span>examiner<span class="sc">}</span><span class="ss"> Comparison Predicting on </span><span class="sc">{</span>examined<span class="sc">}</span><span class="ss">"</span>,fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb120-113"><a href="#cb120-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb120-114"><a href="#cb120-114" aria-hidden="true" tabindex="-1"></a>            ax[j][i].set_xscale(<span class="st">"log"</span>)</span>
<span id="cb120-115"><a href="#cb120-115" aria-hidden="true" tabindex="-1"></a>            ax[j][i].get_xaxis().set_major_formatter(ticker.ScalarFormatter())</span>
<span id="cb120-116"><a href="#cb120-116" aria-hidden="true" tabindex="-1"></a>            ax[j][i].set_xticks(np.unique(y_val1))</span>
<span id="cb120-117"><a href="#cb120-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-118"><a href="#cb120-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-119"><a href="#cb120-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-120"><a href="#cb120-120" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/cp_multiple_validation_files/cp_multiple_validation_40_0.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
</section>
<section id="interpolation" class="level1">
<h1>9. Interpolation</h1>
<p>The code for interpolation is widely the same as the one in Section 8. As such, it is not pasted here (but can be found in <code>notebooks/cp_interpolation.ipynb</code>). Below are the results with arbitrarily assigned tumbling rates <em>between</em> the 10 values we have been using throughout this project.</p>
<section id="interpolation-predictions-on-same-data-types" class="level2">
<h2 class="anchored" data-anchor-id="interpolation-predictions-on-same-data-types">Interpolation Predictions on Same Data Types</h2>
<p>[png](week-20-22-files/more_interpol_std_iqr_comparison_of_self_better.png</p>
</section>
<section id="interpolation-predictions-on-other-data-types" class="level2">
<h2 class="anchored" data-anchor-id="interpolation-predictions-on-other-data-types">Interpolation Predictions on Other Data Types</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/interpol_std_iqr_comparison_of_others_better.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
</section>
<section id="extrapolation" class="level1">
<h1>10. Extrapolation</h1>
<p>Likewise, the code for extrapolation is widely the same as the one in Section 8. The results are plotted below, for both high-bounds extrapolation case (above the 10 training tumbling rates) and low-bounds extrapolation case (below the 10 training tumbling rates).</p>
<section id="low-bound-extrapolation" class="level2">
<h2 class="anchored" data-anchor-id="low-bound-extrapolation">Low-bound Extrapolation</h2>
<section id="predictions-on-same-data-types" class="level3">
<h3 class="anchored" data-anchor-id="predictions-on-same-data-types">Predictions on Same Data Types</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/low_extrapol_self.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="predictions-on-different-data-types" class="level3">
<h3 class="anchored" data-anchor-id="predictions-on-different-data-types">Predictions on Different Data Types</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/low_extrapol_others.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
</section>
<section id="high-bound-extrapolation" class="level2">
<h2 class="anchored" data-anchor-id="high-bound-extrapolation">High-bound Extrapolation</h2>
<section id="predictions-on-same-data-types-1" class="level3">
<h3 class="anchored" data-anchor-id="predictions-on-same-data-types-1">Predictions on Same Data Types</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/high_extrapol_self.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>
</section>
<section id="predictions-on-different-data-types-1" class="level3">
<h3 class="anchored" data-anchor-id="predictions-on-different-data-types-1">Predictions on Different Data Types</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week-20-22-files/high_extrapol_others.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">png</figcaption>
</figure>
</div>


</section>
</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">Made with Quarto (cp branch)</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>